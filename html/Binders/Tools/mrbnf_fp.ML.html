<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/mrbnf_fp.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/mrbnf_fp.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>MRBNF_FP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> construct_binder_fp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>string</span><span> * </span><span class="entity"><span>MRBNF_Def.mrbnf</span></span><span class="main"><span>)</span></span><span> * </span><span>int</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span>
    </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result</span></span><span> * </span><span>local_theory</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>MRBNF_FP</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Def</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Fp_Tactics</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_FP_Def_Sugar</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_TN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"raw_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_ctorN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"_ctor"</span></span><span> </span><span>o</span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"raw_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_renameN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"rename_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_freeN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"free_"</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_levelN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"set"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"_level"</span></span><span> </span><span>o</span><span>
  </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s1</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>s2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVarsN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"FVars_"</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_alphaN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"alpha_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_avoidN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"avoid_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_cctorN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"_ctor"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_rrenameN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"rrename_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FFVarsN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"FFVars_"</span></span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nonzero_string_of_int</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_aavoidN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"aavoid_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_subshapeN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"subshape_"</span></span><span> </span><span>oo</span><span> </span><span>prefix</span><span> </span><span>o</span><span> </span><span>suffix</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_alpha'N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prefix</span><span> </span><span class="inner_quoted"><span>"alpha'_"</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>minus</span></a><span class="antiquote"><span>}</span></span></span><span> </span><span>|&gt;</span><span> </span><span>curry</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_inter</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lattices.html#Lattices.inf_class.inf|const"><span>inf</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_equivp</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Equiv_Relations.html#Equiv_Relations.equivp|const"><span>equivp</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_predT</span></span><span> </span><span class="main"><span>[</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Sigma</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>AT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>BT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ABT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="entity"><span>AT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="entity"><span>BT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.Sigma|const"><span>Sigma</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>AT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>BT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>ABT</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Sigma_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_Sigma</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span>absdummy</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_case_prod</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v2</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="entity"><span>v2</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="entity"><span>v1</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>fold_case_prod'</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
  </span><span>|&gt;</span><span> </span><span>fastype_of</span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_card_of</span></span><span>
  </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sumN_balanced</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_FP_Util.mk_sumprod_balanced</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Util.mk_sumTN_balanced</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_case_sumN_balanced</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Balanced_Tree.make</span><span> </span><span class="entity"><span>BNF_FP_Util.mk_case_sum</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>primrec</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>BNF_LFP_Rec_Sugar.primrec_simple</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>primcorec</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>specs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>term</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> * </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>decl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span>|&gt;</span><span> </span><span>Free</span><span> </span><span>o</span><span> </span><span>apfst</span><span> </span><span>Binding.name_of</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>specs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="entity"><span>BNF_GFP_Rec_Sugar.primcorec_ursive</span></span><span> </span><span class="entity"><span>int</span></span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>fixes</span></span><span> </span><span class="entity"><span>specs'</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>specs</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
    </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goalss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"\"auto\" failed"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>:</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Spec_Rules.retrieve</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>decl</span></span><span>
      </span><span>|&gt;</span><span> </span><span>hd</span><span>
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>terms </span><span class="entity"><span>spec</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>single</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rules </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_raw_terms</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* Get mrbnf info *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>frees</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_sortss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_split</span><span>
      </span><span class="main"><span>(</span></span><span>`</span><span>length</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>dest_TVar</span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>frees_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_sortss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_split</span><span>
      </span><span class="main"><span>(</span></span><span>`</span><span>length</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>dest_TVar</span><span> </span><span>#&gt;</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>bounds_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span class="entity"><span>lives_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Type</span><span> </span><span>o</span><span> </span><span class="entity"><span>T_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Error checking *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>List.Empty</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>msg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>List.all</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="inner_quoted"><span>"Number of free types must be equal"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="inner_quoted"><span>"Number of bound types must be equal"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="inner_quoted"><span>"Number of live types must be equal"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span>List.all</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
        </span><span>error</span><span> </span><span class="inner_quoted"><span>"All ks must not be negative"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"All ks must be at least one"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k_sum</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span>&gt;=</span><span> </span><span class="entity"><span>k_sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"Sum of ks must not exceed number of live types"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span>o</span><span> </span><span>filter</span><span> </span><span>I</span><span> </span><span>oo</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>List.exists</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>k_sum</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_bounds</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"Need at least one binding"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_bounds</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"Not enough free types"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_bounds</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"Not enough bound types"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sort</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>sort</span><span> </span><span class="main"><span>=</span></span><span> </span><span>distinct</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>coclass_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>all_equal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>free_sortss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_sortss</span></span><span class="main"><span>)</span></span><span>
        </span><span class="inner_quoted"><span>"Sorts of free and bound types must be equal"</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b_sorts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound</span></span><span>-</span><span class="entity"><span>bound_bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Make names and construct groups *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_TN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Local_Theory.full_name</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_ctorN</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees_lives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>f_sorts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>live</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>k_sum</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span>
      </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>b_sorts</span></span><span> </span><span>|&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_T_group</span></span><span> </span><span class="entity"><span>TN</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_lives</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_groups</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lives</span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="entity"><span>bound_bounds</span></span><span> </span><span class="entity"><span>frees_lives</span></span><span> </span><span>@</span><span>
      </span><span>List.concat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_T_group</span></span><span> </span><span class="entity"><span>TNs</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span>dest_TFree</span><span> </span><span>#&gt;&gt;</span><span> </span><span>snd</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>#&gt;</span><span> </span><span>pair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees_lives</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Build spec *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_T_spec</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>T_Ts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ctor_spec</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ctorN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span>Binding.name</span><span> </span><span class="entity"><span>ctorN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>single</span><span> </span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_groups</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_T_specs</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>ctorN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mk_T_spec</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_ctor_spec</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>ctorN</span></span><span> </span><span>|&gt;</span><span> </span><span>single</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span>Binding.empty</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_specs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_T_specs</span></span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>ctorNs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define co-datatype *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>BNF_FP_Def_Sugar.co_datatypes</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="entity"><span>BNF_GFP.construct_gfp</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>BNF_FP_Def_Sugar.co_datatypes</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="entity"><span>BNF_LFP.construct_lfp</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>K</span><span> </span><span>false</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_specs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_sugars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="entity"><span>BNF_FP_Def_Sugar.fp_sugar_of</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TNs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>free</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_lives</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>dest_TFree</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_prem_terms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>test_TEqu</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>T1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>T2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Types must be equal"</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_small_support</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_supp</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_small_support_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_small_support</span></span><span> </span><span>#&gt;</span><span> </span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bij</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span>|&gt;</span><span> </span><span>fastype_of</span><span>
      </span><span>|&gt;</span><span> </span><span>dest_funT</span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>test_TEqu</span></span><span>
      </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span>
      </span><span>|-&gt;</span><span> </span><span class="entity"><span>BNF_LFP_Util.mk_bij_betw</span></span><span> </span><span class="entity"><span>t</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_bij_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bij</span></span><span> </span><span>#&gt;</span><span> </span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_bij_imp</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_small_support_imp</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_bij</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_small_support</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>construct_binder_fp</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>mrbnf_ks</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="comment1"><span>(* Error checking *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Greatest_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>true</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Least_FP</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>false</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span>error</span><span> </span><span class="inner_quoted"><span>"Invalid fixpoint"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>mrbnf_ks</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Need at least one mrbnf"</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span> </span><span class="entity"><span>mrbnf_ks</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define raw datatype *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sorts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>define_raw_terms</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>k_ranges</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_range</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>maps</span><span> </span><span class="entity"><span>mk_range</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Normalise binding relation *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>in_range</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>&lt;=</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>remove_duplicates</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>remove_duplicates</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>remove_duplicates</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x'</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>x'</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>remove_duplicates</span></span><span> </span><span>o</span><span> </span><span>sort</span><span> </span><span>int_ord</span><span> </span><span>o</span><span> </span><span>filter</span><span> </span><span class="entity"><span>in_range</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span>
          </span><span>|&gt;</span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>null</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>passive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>sorts</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pfree</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>passive</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>pfree</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>pbound</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>num_bindings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>length</span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>false</span><span>
      </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth_map</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_rels</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binding_matrixt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>all_bindings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>List.all</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_matrixt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>List.all</span><span> </span><span>not</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_matrixt</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_vec</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span> </span><span class="entity"><span>xss</span></span><span> </span><span class="entity"><span>yss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="entity"><span>xss</span></span><span> </span><span class="entity"><span>yss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Helper functions *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_term</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Term.add_tvar_names</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>terms</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_term</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_typs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>types</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_typ</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.typ_subst_TVars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Term.add_tvar_namesT</span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_typ</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>types</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bij</span></span><span>::</span><span class="entity"><span>supp</span></span><span>::</span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bij</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
        </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>supp</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="entity"><span>assms</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id_prems2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bij_id_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bij_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refl_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pfree</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span>
          </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bij_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pfree</span></span><span>+</span><span class="entity"><span>pbound</span></span><span class="main"><span>)</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>refls</span></span><span> </span><span class="entity"><span>rs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pfree</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
          </span><span>replicate</span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>OF_prems</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>refl_prems</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>OF_prems</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>refls</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>OF_prems</span></span><span> </span><span class="entity"><span>ids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>OF_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>OF_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bij_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>OF_prems</span></span><span> </span><span class="entity"><span>bij_ids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refl_prems</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Functions for sets and set_transfers *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_rel_funD_settss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>sett</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_funD</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>sett</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>split_setss</span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>##&gt;</span><span> </span><span>drop</span><span> </span><span class="entity"><span>passive</span></span><span> </span><span>##&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>setss</span></span><span>
      </span><span>|&gt;</span><span> </span><span>split_list</span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>split_setss_transp</span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>setss</span></span><span> </span><span>|&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>||&gt;</span><span> </span><span>drop</span><span> </span><span class="entity"><span>passive</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Make free types *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>paramT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_TFrees'</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
      </span><span>||&gt;</span><span> </span><span>the_single</span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_TFrees</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_typs</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctrs </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>un_ctorsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>selss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_casexsAs</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>casex </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Make frees *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>frees_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fAs</span></span><span> </span><span class="entity"><span>fAs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fAs</span></span><span> </span><span class="entity"><span>fAs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="entity"><span>CAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y'"</span></span><span> </span><span class="entity"><span>CAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z"</span></span><span> </span><span class="entity"><span>fAs</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"A"</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"ρ"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>paramT</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Param"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>paramT</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"varsOf"</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>paramT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>fAs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Make mrbnf terms *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>unflat</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span class="entity"><span>mk_Ts'</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span> </span><span class="entity"><span>repl</span></span><span> </span><span class="entity"><span>app_Us</span></span><span> </span><span class="entity"><span>map_fun</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TAs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>pFs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pTAs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pBs'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>pfree</span></span><span> </span><span class="entity"><span>TAs'</span></span><span> </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>plive</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pTBs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fbound</span></span><span>+</span><span class="entity"><span>pfree</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Bs</span></span><span> </span><span>|&gt;</span><span> </span><span>take</span><span> </span><span class="entity"><span>plive</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CAs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CBs'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mrbnf_id_map</span></span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>app_Us</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pTBs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>CBs'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>repl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>deads_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>repl</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pTAs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>CAs'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>repl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pBs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Fs'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>repl</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>Fs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pFs'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>repl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>map_fun</span></span><span> </span><span class="main"><span>(</span></span><span>Term.subst_atomic_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Fs'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Fs</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Ts'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TAs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pTBs'</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>mk_mrbnf_id_map</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mrbnf_id_terms</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_id_terms</span></span><span> </span><span class="entity"><span>mk_map_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_rels_AsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_id_terms</span></span><span> </span><span class="entity"><span>mk_mr_rel_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_setss_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_id_terms</span></span><span> </span><span class="entity"><span>mk_sets_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>passive</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>rec_live</span></span><span>
      </span><span>|&gt;</span><span> </span><span>replicate</span><span class="main"><span>)</span></span><span> </span><span>snd</span><span> </span><span>map</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>free_setss_Ast</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_setss_Ast</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss_transp</span></span><span> </span><span class="entity"><span>mrbnf_setss_As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss</span></span><span> </span><span class="entity"><span>mrbnf_setss_As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>non_recs</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_term</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>non_recs</span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>non_recs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>recs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define rename primrec *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>renamesAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*renames*)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*rename_defs*)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="comment1"><span>(* Make names and types *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>renameNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_renameN</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Binding.name</span><span> </span><span class="entity"><span>renameNs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span>---&gt;</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="comment1"><span>(* Make terms for primrec definition *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>o</span><span> </span><span>Free</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renameNs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_def_terms</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span>$</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_codef_terms</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span class="entity"><span>un_ctorAs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span>$</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span>
              </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>un_ctorAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_codef_terms</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>un_ctorsAs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_def_terms</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="comment1"><span>(* Define primrec and export terms and theorems *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>primcorec</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>primrec</span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>rename_bs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>def_terms</span></span><span>
          </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>termsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>#&gt;</span><span> </span><span>`</span><span>dest_Const</span><span> </span><span>#&gt;&gt;</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span>oo</span><span> </span><span>rpair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Morphism.fact</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>termsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>mr_rel_refl_ids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mr_rel_refl_strong_ids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_fun</span></span><span> </span><span class="entity"><span>map</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>map</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_rel_id_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subs_rel</span></span><span> </span><span class="entity"><span>of_mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_fun</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>apply</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>subs_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rel_refl_of_mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_refl_strong_of_mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rel_mono_strong_of_mrbnf</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>natLeq_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>natLeq_bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Un_bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>UNION_bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_boundss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>set_bd_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_bd</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_ordLeq_trans|fact"><span>ordLess_ordLeq_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_bd</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>var_large_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>var_infinites</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.cinfinite_def|fact"><span>cinfinite_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.Field_card_of|fact"><span>Field_card_of</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>o</span><span> </span><span class="entity"><span>UNIV_cinfinite_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>id_prems</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_set_transfer_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>free_settss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss_transp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rel_funD_settss</span></span><span> </span><span class="entity"><span>settss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>supp_comp_bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>map_comp_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>map_cong_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>id_prems</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>set_map_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>set_maps</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_monos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id_prems</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_rel_mono_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mr_rel_eq_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth_map</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>bij_id_prems</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span>
      </span><span>nth_map</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>nth_map</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span>
      </span><span class="entity"><span>mr_rel_map_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>refl_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>6</span></span><span>*</span><span class="entity"><span>fbound</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ballI</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span> </span><span>o</span><span>
      </span><span class="entity"><span>mr_rel_mono_strong0_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_le_rel_OOs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_le_rel_OO_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_flips</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>bij_prems</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_rel_flip_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_prem_terms</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_terms_ffs_fgs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_prem_terms</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_bound</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>Thm.close_derivation</span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conjs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>split_Nconjs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>split_conjs</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>split_conjs</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conjunct1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>split_conjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conjunct2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conjs</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&lt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>single</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>split_conjs</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_inst</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_coinduct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"l"</span></span><span> </span><span class="entity"><span>Ts</span></span><span>
          </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"r"</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lhs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_split</span><span> </span><span class="entity"><span>HOLogic.dest_eq</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>rs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="entity"><span>rhss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rhs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="entity"><span>rhss</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>meta_mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>,</span></span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rels</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>insts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_common_co_induct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>T_sugars</span></span><span> </span><span>|&gt;</span><span> </span><span>the</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_co_induct_sugar </span><span>|&gt;</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>common_co_inducts
      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>mr_rel_id_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_common_co_induct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_coinduct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>raw_common_co_induct</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_induct_inst</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>raw_common_co_induct</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>injects </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_splits</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>split </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_exhausts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>exhaust </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_nchotomys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>nchotomy </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_sels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>sel_thmss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_collapses</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>collapses </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctr_sugar </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>fp_ctr_sugar</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_sugars</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_simp</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span class="entity"><span>un_ctorAs</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>rename_simp</span></span><span> </span><span class="entity"><span>raw_sel</span></span><span>
      </span><span class="entity"><span>raw_collapse</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_sel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sel_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>un_ctorAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>un_ctorAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_rename_sel_tac</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>rename_simp</span></span><span> </span><span class="entity"><span>raw_sel</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>sel_goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span>SOME</span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_sel'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>rename_sel</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctorAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctorAs</span></span><span> </span><span>$</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>rename_sel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_rename_simps_tac</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>rename_simp</span></span><span> </span><span class="entity"><span>rename_sel'</span></span><span> </span><span class="entity"><span>raw_sel</span></span><span> </span><span class="entity"><span>raw_collapse</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_sels</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rename_simp</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>un_ctorsAs</span></span><span> </span><span class="entity"><span>map_comps</span></span><span>
        </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>raw_sels</span></span><span> </span><span class="entity"><span>raw_collapses</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span> </span><span>|&gt;&gt;</span><span> </span><span>map_filter</span><span> </span><span>I</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fids</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_co_induct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_cong_thm</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>map_cong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_id0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
          </span><span>RS</span><span> </span><span class="entity"><span>fun_cong</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_apply|fact"><span>id_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_cong_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_map_cong_thm</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rename_ids_tac</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>map_cong_thms</span></span><span>
          </span><span class="entity"><span>rename_sels</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_id0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.meta_eq_to_obj_eq|fact"><span>meta_eq_to_obj_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
      </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.abs_def_rule</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span>
          </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span>
          </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_co_induct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rename_comps_tac</span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span>
          </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>map_congs</span></span><span> </span><span class="entity"><span>rename_sels</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs_fgs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_comp0s</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs_fgs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
           </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ctr_Sugar_Tactics.unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ctr_Sugar_Tactics.unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
         </span><span class="main"><span>]</span></span><span>
       </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_comp0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rename_comp0s</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_bij</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>rename_comp0</span></span><span> </span><span class="entity"><span>rename_id0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bij</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_bij_tac</span></span><span> </span><span class="entity"><span>rename_comp0</span></span><span> </span><span class="entity"><span>rename_id0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_bijs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_bij</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>rename_comp0s</span></span><span> </span><span class="entity"><span>rename_id0s</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_inv_simp</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>rename_comp0</span></span><span> </span><span class="entity"><span>rename_id0</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_inv_simp_tac</span></span><span> </span><span class="entity"><span>rename_comp0</span></span><span> </span><span class="entity"><span>rename_id0</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_inv_simps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_inv_simp</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>rename_comp0s</span></span><span> </span><span class="entity"><span>rename_id0s</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define inductive predicate free *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inductive</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="entity"><span>free_sets</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span>o</span><span> </span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_freeN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>quiet_mode </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> verbose </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> alt_name </span><span class="main"><span>=</span></span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span>
          coind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_elim </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_ind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> skip_mono </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>free_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span>oo</span><span> </span><span>pair</span><span> </span><span>o</span><span> </span><span>Binding.name_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_terms</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>free_t</span></span><span> </span><span class="entity"><span>free_set</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>free_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_non_mem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span>|&gt;</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>free_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>add_non_mem</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>|&gt;</span><span> </span><span>rpair</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span>#&gt;</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>t_free</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>rec_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_terms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>free_ts</span></span><span> </span><span class="entity"><span>free_sets</span></span><span>
          </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>Inductive.add_inductive</span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NoSyn</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>Binding.empty_atts</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>invar_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inductive.transform_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>subst_free</span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.subst_TVars</span><span>
          </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Term.add_tvar_namesT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>free</span></span><span> </span><span>|&gt;</span><span> </span><span>range_type</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>rev</span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>subst_free</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>frees_invar_results</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>freessAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*freess*)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_inductive</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span>
        </span><span class="entity"><span>free_setss_Ast</span></span><span> </span><span class="entity"><span>bound_setss_Ast</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define FVars *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_FVars</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_FVarsN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>FVars_termss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_defss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>define_FVars</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>freessAs</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_termss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_free_FVars</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>freeAs</span></span><span> </span><span class="entity"><span>FVarsAs</span></span><span> </span><span class="entity"><span>FVars_def</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>FVars_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mem_Collect_eq</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>freeAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>free_FVarsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_free_FVars</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>freessAs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span>
      </span><span class="entity"><span>FVars_defss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_inducts</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_elimss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>apply</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>free_FVarsss</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>induct </span><span class="entity"><span>frees_invar_results</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>intrs </span><span class="entity"><span>frees_invar_results</span></span><span class="main"><span>,</span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>elims </span><span class="entity"><span>frees_invar_results</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVars_ctor</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>free_set</span></span><span> </span><span class="entity"><span>bound_set</span></span><span>
      </span><span class="entity"><span>FVars_elim</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_Diff</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>add_Diff</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>UNs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_FVars_ctorss_Tac</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span> </span><span class="entity"><span>FVars_elim</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FVars_ctor</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span> </span><span class="entity"><span>free_setss_Ast</span></span><span> </span><span class="entity"><span>bound_setss_Ast</span></span><span> </span><span class="entity"><span>FVars_elimss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVars_rename_les</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>o</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>oo</span><span> </span><span>rpair</span><span> </span><span>o</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>oo</span><span> </span><span>pair</span><span> </span><span>o</span><span>
          </span><span>list_comb</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_FVars_rename_les_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>set_map</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_rename_less</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_FVars_rename_les</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>FVars_inducts</span></span><span>
      </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVars_rename</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>rename_recAs</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="entity"><span>FVars_rename_le</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span class="main"><span>(</span></span><span class="entity"><span>rename_recAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVars_rename_le_alt</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FVars_rename_le</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_FVars_rename_tac</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>FVars_rename_le</span></span><span> </span><span class="entity"><span>mk_FVars_rename_le_alt</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_renamess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FVars_rename</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>FVars_rename_less</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_card_of_FVars_bounds</span></span><span> </span><span class="entity"><span>rec_set_boundss</span></span><span> </span><span class="entity"><span>free_set_bounds</span></span><span> </span><span class="entity"><span>free_sets</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>FVarssAs</span></span><span>
      </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_FP_Util.mk_sumTN_balanced</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
            </span><span>|&gt;</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"n"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span>
            </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>tT</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_levelAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*set_level_def*)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_level_simps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="comment1"><span>(* Make names and types *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_levelN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_set_levelN</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_level_b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.name</span><span> </span><span class="entity"><span>set_levelN</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_levelAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>tT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* Make terms for primrec definition *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_level_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_levelN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_levelAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zero_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_level_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.zero</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>casexs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_casexsAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_union_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>set_level_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>nat</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_sumN_balanced</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>casex</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>casex</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span>
                  </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_union_term</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span>
                </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suc_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_level_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_Suc</span></span><span> </span><span class="entity"><span>nat</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_case_term</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>casexs</span></span><span> </span><span class="entity"><span>free_sets</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_case_sumN_balanced</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="comment1"><span>(* Define primrec and export terms and theorems *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>Local_Theory.begin_nested</span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>primrec</span></span><span> </span><span>false</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>set_level_b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_levelAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>zero_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suc_term</span></span><span class="main"><span>]</span></span><span>
                </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>termAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_single</span><span> </span><span class="entity"><span>terms</span></span><span> </span><span>|&gt;</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span>|&gt;</span><span> </span><span>dest_Const</span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span>oo</span><span> </span><span>rpair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_levelAs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Morphism.fact</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>defs</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>simpss</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>the_single</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>termAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ifcos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>bd_infinite_regular_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_level_bound</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>set_levelAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>nat</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nat_induct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Nat.html#Nat.nat.induct|fact"><span>nat.induct</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_set_level_bound_tac</span></span><span> </span><span class="entity"><span>nat_induct</span></span><span> </span><span class="entity"><span>set_level_simps</span></span><span> </span><span class="entity"><span>raw_splits</span></span><span> </span><span class="entity"><span>ifcos</span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span>
                </span><span class="entity"><span>free_set_bounds</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>rec_set_boundss</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>nat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_overapproxs</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>HOLogic.natT</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>set_levelAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>nat</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>mk_sumN_balanced</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>nat</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>FVarssAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_FVars_overapprox_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>set_level_simps</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>raw_splits</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suc_ifcos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ifco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_infinite_regular_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order_card_suc|fact"><span>infinite_regular_card_order_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.card_order|fact"><span>infinite_regular_card_order.card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.Cinfinite|fact"><span>infinite_regular_card_order.Cinfinite</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ifco</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Composition.html#BNF_Composition.regularCard_UNION_bound|fact"><span>regularCard_UNION_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.Cinfinite|fact"><span>infinite_regular_card_order.Cinfinite</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.regularCard|fact"><span>infinite_regular_card_order.regularCard</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suc_ifcos</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_card_of_FVars_bound</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>FVars_overapprox</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="entity"><span>card_order</span></span><span> </span><span class="entity"><span>natLeq_bound</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_suc</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_level_bound'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_transitive|fact"><span>ordLess_transitive</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>set_level_bound</span></span><span class="main"><span>,</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_suc_greater|fact"><span>card_suc_greater</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>card_order</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UNIV|const"><span>UNIV</span></a><span class="main"><span>::</span></span><a class="entity_ref" href="../../../../../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>]</span></span><span>
                </span><span class="entity"><span>UNION_bound</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_level_bound'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_co_card_of_FVars_bounds_tac</span></span><span> </span><span class="entity"><span>FVars_overapprox</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="entity"><span>natLeq_bound</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_card_of_FVars_bound</span></span><span> </span><span class="entity"><span>FVarssAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>FVars_overapproxs</span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>bd_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span>
            </span><span>|&gt;</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="comment1"><span>(* TODO: fix for mutual recursion, also do in co branch *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bound</span></span><span> </span><span>o</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVarssAs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_co_induct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order_Un|fact"><span>infinite_regular_card_order_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bd_infinite_regular_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ifco</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_infinite_regular_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Composition.html#BNF_Composition.regularCard_UNION_bound|fact"><span>regularCard_UNION_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.Cinfinite|fact"><span>infinite_regular_card_order.Cinfinite</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.infinite_regular_card_order.regularCard|fact"><span>infinite_regular_card_order.regularCard</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ifco</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intross</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Un_bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_set_bounds</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rec_set_boundss</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="entity"><span>mk_card_of_FVars_bounds_tac</span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>intross</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
            </span><span>|&gt;</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card_of_FVars_boundss'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_boundss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_bd_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_sboundss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_sboundss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss_transp</span></span><span> </span><span class="entity"><span>set_boundss</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of_FVars_bounds</span></span><span> </span><span class="entity"><span>rec_sboundss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_sboundss</span></span><span> </span><span class="entity"><span>free_setss_Ast</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>FVars_inducts</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="entity"><span>transpose</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_of_FVars_boundss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ordIso</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.cardSuc_ordIso_card_suc|fact"><span>cardSuc_ordIso_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>card_order</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordIso_symmetric|fact"><span>ordIso_symmetric</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>covar_large</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordIso_ordLeq_trans|fact"><span>ordIso_ordLeq_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ordIso</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>covar_large </span><span class="main"><span>(</span></span><span class="entity"><span>class_thms_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_ordLeq_trans|fact"><span>ordLess_ordLeq_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>covar_large</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>var_large_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="entity"><span>card_of_FVars_boundss'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define alpha relation *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphas_invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alphasAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*alphas*)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarsBssAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_alphaN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>quiet_mode </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> verbose </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> alt_name </span><span class="main"><span>=</span></span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span>
          coind </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> no_elim </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_ind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> skip_mono </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span>oo</span><span> </span><span>pair</span><span> </span><span>o</span><span> </span><span>Binding.name_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVarsBs</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>)</span></span><span>
                  </span><span>#-&gt;</span><span> </span><span class="entity"><span>mk_UNION</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="entity"><span>FVarsBs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha_ts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span>
              </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span>@</span><span>
              </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span>
              </span><span>map2</span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="entity"><span>rename_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems1</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>add_prems</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>|&gt;</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>FVarsBs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarsBss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_term</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>alpha_ts</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span>
          </span><span class="entity"><span>rec_setss_As</span></span><span> </span><span class="entity"><span>mrbnf_rels_AsAs</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>monos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span>OF</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_monos</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.conj_context_mono|fact"><span>conj_context_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>Inductive.add_inductive</span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NoSyn</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>Binding.empty_atts</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>monos</span></span><span>
          </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>invar_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inductive.transform_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarsBss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>induct </span><span class="entity"><span>alphas_invar_result</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_intros</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>intrs </span><span class="entity"><span>alphas_invar_result</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>elims </span><span class="entity"><span>alphas_invar_result</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span>o</span><span> </span><span class="entity"><span>Induct.lookup_casesT</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Type</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_intros_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_intros</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_cases</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_case</span></span><span> </span><span class="entity"><span>T_cases</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_refls_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="entity"><span>mk_cases</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
          </span><span class="entity"><span>mr_rel_refl_strong_ids</span></span><span> </span><span class="entity"><span>alpha_intros</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.spec2|fact"><span>spec2</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>refl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ls</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f'"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>|&gt;</span><span> </span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"l"</span></span><span> </span><span class="entity"><span>CAs</span></span><span>
          </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"r"</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>l</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_eq</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_rename_eq</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_rename_eq</span></span><span> </span><span class="entity"><span>fs'</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ball_eq</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>f'</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ball_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_ball_eq</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>fs'</span></span><span> </span><span class="entity"><span>zs</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem_terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_prem_terms</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rename_eqs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ball_eqs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prem_terms</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>l</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>l</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>]</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ls</span></span><span> </span><span class="entity"><span>rs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exIss</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs'</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exI_ts1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>)</span></span><span>
              </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exI_ts2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span class="entity"><span>fs'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exI_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exI_ts1</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>exI_ts2</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>|&gt;</span><span> </span><span>apply2</span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="entity"><span>map_fun</span></span><span> </span><span class="entity"><span>exI_ts</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>OF_exI</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>OF_conj_rotated</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>OF_conjI_folded</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&lt;=</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_conjIN</span></span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.spec2|fact"><span>spec2</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>funpow</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="main"><span>(</span></span><span class="entity"><span>fbound</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>OF_exI</span></span><span>
                </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>funpow</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>OF_conj_rotated</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>OF_conjI_folded</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_bij_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>num_bindings</span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span>
          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>mk_exIss</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>after_qed</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_t_ffs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t_ffs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t_ffs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_alt</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_bij</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>assms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_alts</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>mk_alpha_bij_alt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv_assms</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_bij_eq_tac</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>mk_alpha_bij_alts</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span>
      </span><span class="entity"><span>rename_ids</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq_inv</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rename_id</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bij</span></span><span>::</span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.inv_o_simp2|fact"><span>inv_o_simp2</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bij</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t_insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_comp_alt</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>t_insts</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_unfolds</span></span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_bij_eq_inv_tac</span></span><span> </span><span class="entity"><span>mk_rename_comp_alt</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq_inv</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span>
      </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_FVars_les</span></span><span> </span><span class="entity"><span>reverse</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>set_transfers</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>reverse</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_FVars_les_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>reverse</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rec_live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>set_transfers</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_FVars_less</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zip_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>zip_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_bound_sett</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span class="entity"><span>free_setts</span></span><span> </span><span class="entity"><span>bound_setts</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>bound_setts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>o</span><span> </span><span>K</span><span class="main"><span>)</span></span><span>
            </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>zip_opt</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>::</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_setts</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>transpose</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_transferss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_bound_sett</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_settss</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span>
          </span><span class="entity"><span>binding_matrix</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>reverse</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_alpha_FVars_les</span></span><span> </span><span class="entity"><span>reverse</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span>
          </span><span class="entity"><span>FVars_inducts</span></span><span> </span><span class="entity"><span>set_transferss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>false</span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>~~</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_FVars</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_FVars_le_left</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_FVars_le_right</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_FVars_tac</span></span><span> </span><span class="entity"><span>alpha_FVars_le_left</span></span><span> </span><span class="entity"><span>alpha_FVars_le_right</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha_FVars</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>alpha_FVars_less</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_b_setts</span></span><span> </span><span class="entity"><span>rec_setts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rec_setts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_b_setts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_sym_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>alpha_FVarsss</span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span> </span><span class="entity"><span>mr_rel_flips</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span> </span><span class="entity"><span>settsss</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"s"</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>supp_comp_bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_b_setts</span></span><span> </span><span class="entity"><span>rec_setts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>rec_setts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_b_setts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>supp_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mr_rel_mono_alt</span></span><span> </span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span class="entity"><span>mr_le_rel_OO</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_le_rel_OO</span></span><span> </span><span>RS</span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.predicate2D|fact"><span>predicate2D</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>supp_ids</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>supp_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_mono_alts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_mr_rel_mono_alt</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>id_prems</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_rel_mono_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_id</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>id_prems2</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mr_le_rel_OO_of_mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_unique</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_unique</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>is_unique</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_unique_grouped</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>is_unique</span></span><span> </span><span class="entity"><span>xs</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_unique_grouped</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span>::</span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span class="entity"><span>is_unique</span></span><span> </span><span>||&gt;</span><span> </span><span class="entity"><span>is_unique_grouped</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span>|&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>@</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>filter_unique</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>filter_like</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_unique_grouped</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_like</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span>not</span><span class="main"><span>)</span></span><span> </span><span>not</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_comp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_comp</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span>
          </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_bijs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span>~~</span><span>
          </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>o</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _ _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span>map</span><span> </span><span>flat</span><span> </span><span>o</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_like</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span>not</span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span>
          </span><span>||&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_rename_comp</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>filter_unique</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_alpha_bij</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_trans_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span>
          </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span> </span><span class="entity"><span>mr_rel_mono_alts</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span> </span><span class="entity"><span>settsss</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exI</span></span><span class="main"><span>]</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conjI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_of_FVarsB_boundss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_b_bounds</span></span><span> </span><span class="entity"><span>set_bounds</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="entity"><span>card_of_FVars_bounds</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>set_bounds</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>card_of_FVars_bounds</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>nth</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UNION_bound</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="entity"><span>set_bound</span></span><span> </span><span class="entity"><span>card_of_FVars_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLeq_ordLess_trans|fact"><span>ordLeq_ordLess_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL-Cardinals/Cardinal_Order_Relation.html#Cardinal_Order_Relation.card_of_diff|fact"><span>card_of_diff</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>set_bound</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>card_of_FVars_bound</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Un_bound_OF</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldl1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_card_of_FVarsB_bound</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="entity"><span>b_rel_bounds</span></span><span> </span><span class="entity"><span>set_bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>b_rel_bounds</span></span><span>
          </span><span>|-&gt;</span><span> </span><span class="entity"><span>mk_b_bounds</span></span><span> </span><span class="entity"><span>set_bounds</span></span><span> </span><span>|-&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UNION_bound</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>Un_bound_OF</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_card_of_FVarsB_bounds</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span class="entity"><span>UNION_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of_FVarsB_bound</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span>
          </span><span class="entity"><span>UNION_bound</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>binding_relation</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>card_of_FVars_boundss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_set_boundsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>o</span><span> </span><span>take</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>o</span><span> </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span>+</span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>set_boundss</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_card_of_FVarsB_bounds</span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="entity"><span>UNION_bounds</span></span><span> </span><span class="entity"><span>rec_set_boundsss</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>refresh_set</span></span><span> </span><span class="entity"><span>FVarsBs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>mrbnf_set_bounds</span></span><span> </span><span class="entity"><span>mrbnf_var_infinite</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span>
      </span><span class="entity"><span>card_of_FVarsB_bounds</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span>
          </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>id</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_map_AsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span>
          </span><span>map2</span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="entity"><span>rename_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="entity"><span>set_t</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inter</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="entity"><span>FVarsBs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>concls1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>concls2</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_insert_thms</span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_ordLeq|fact"><span>card_of_ordLeq</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_imp_ordLeq|fact"><span>ordLess_imp_ordLeq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>fset</span></span><span>"</span></span><span>
            </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UNIV|const"><span>UNIV</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>FVarsB</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.union|const"><span>∪</span></a></span><span> </span><span class="free"><span>fset</span></span><span class="main"><span>)</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>for</span></span></span><span> </span><span class="free"><span>set</span></span><span> </span><span class="free"><span>fset</span></span><span> </span><span class="free"><span>FVarsB</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insert_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_insert_thms</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>[</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarsBs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exI_thms</span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.extU|const"><span>extU</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>fset</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>u</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>for</span></span></span><span> </span><span class="free"><span>set</span></span><span> </span><span class="free"><span>fset</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exI_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_exI_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>[</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_extU_thms</span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.extU|fact"><span>extU</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>u</span></span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>fset</span></span><span>"</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>u</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>set</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>∩</span></a></span><span> </span><span class="free"><span>fset</span></span><span class="main"><span>)</span></span><span>"</span></span><span> </span><span class="quasi_keyword"><span class="quasi_keyword"><span>for</span></span></span><span> </span><span class="free"><span>set</span></span><span> </span><span class="free"><span>fset</span></span><span> </span><span class="free"><span>u</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>extU_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_extU_thms</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>[</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_refresh_set_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>mrbnf_var_infinite</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span class="entity"><span>insert_thms</span></span><span> </span><span class="entity"><span>mrbnf_set_bounds</span></span><span>
          </span><span class="entity"><span>card_of_FVarsB_bounds</span></span><span> </span><span class="entity"><span>exI_thms</span></span><span> </span><span class="entity"><span>extU_thms</span></span><span> </span><span class="entity"><span>set_map</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>refresh_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>take_bounds</span></span><span> </span><span class="entity"><span>xss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>o</span><span> </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fbound</span></span><span>+</span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xss</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>refresh_set</span></span><span> </span><span class="entity"><span>FVarsBssAs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>take_bounds</span></span><span> </span><span class="entity"><span>set_boundss</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>var_infinites</span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="entity"><span>card_of_FVarsB_boundss</span></span><span> </span><span class="entity"><span>set_maps</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_avoid_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>set_t</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inter</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_refresh</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>refresh_set</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>rel_map</span></span><span>
      </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_avoid_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x'</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>cfs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_t</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>cfs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>o</span><span> </span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span>
              </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rename_t</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_map_AsAs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>rename_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.exI|fact"><span>exI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_refresh_set</span></span><span> </span><span class="entity"><span>assms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>refresh_set</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>assms</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_refresh_tac</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>rel_map</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>mk_refresh_set</span></span><span> </span><span class="entity"><span>mk_exI</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>refreshs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_refresh</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>refresh_sets</span></span><span>
      </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>alpha_intros</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define avoid *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>avoid_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoid_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x'T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x'Free</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>x'</span></span><span> </span><span>|&gt;</span><span> </span><span>`</span><span>snd</span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>mk_avoid_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="entity"><span>x'Free</span></span><span> </span><span>|&gt;</span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.choice_const</span></span><span> </span><span class="entity"><span>x'T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_avoidN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>avoidsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>avoid_terms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_avoid</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>avoid_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>refresh</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_Nconjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fbound</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_avoid_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>avoid_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_avoid_tac</span></span><span> </span><span class="entity"><span>avoid_defs</span></span><span> </span><span class="entity"><span>refresh</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>avoid_freshss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_avoids</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_avoid</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>avoidsAs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>refreshs</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>##&gt;</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define quotient type *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_TT</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span>domain_type</span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>BNF_GFP_Util.mk_quotient</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>new_typedef</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rhs</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Equiv_Relations.html#Equiv_Relations.proj_preserves|fact"><span>proj_preserves</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>TT_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_infos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>define_TT</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_type_definitions</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>type_definition </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_infos</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_names</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_Abss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_Reps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_abs_and_rep</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="entity"><span>info</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Abs_name </span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Rep_name </span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_abs_and_rep</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>TT_infos</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_abs</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>Abs_t</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Quotient.html#Quotient.quot_type.abs|const"><span>quot_type.abs</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
          </span><span>fastype_of</span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>--&gt;</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>Abs_t</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Abs_t</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_abs</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>TT_Abss</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CBs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_rep</span></span><span> </span><span class="entity"><span>Rep_t</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Quotient.html#Quotient.quot_type.rep|const"><span>quot_type.rep</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
          </span><span>fastype_of</span><span> </span><span class="entity"><span>Rep_t</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Rep_t</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_rep</span></span><span> </span><span class="entity"><span>TT_Reps</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CBs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_maps_AsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>mk_map_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>mk_map_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_maps_BsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>mk_map_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_rels_BsBs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>mk_mr_rel_of_mrbnf</span></span><span> </span><span>I</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>|&gt;</span><span> </span><span>I</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_setss_Bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mrbnf_terms</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>mk_sets_of_mrbnf</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>passive</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>replicate</span><span class="main"><span>)</span></span><span> </span><span>snd</span><span> </span><span>map</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>free_setss_Bst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_setss_Bst</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss_transp</span></span><span> </span><span class="entity"><span>mrbnf_setss_Bs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>free_setss_Bs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>split_setss</span></span><span> </span><span class="entity"><span>mrbnf_setss_Bs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ws'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mrbnf_rep_T</span></span><span> </span><span class="entity"><span>mrbnf_rep_map_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip_typeN</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>passive</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>rec_live</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>mrbnf_rep_map_As</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>domain_type</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_rep_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mrbnf_rep_T</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"w"</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"w'"</span></span><span> </span><span class="entity"><span>CBs</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"v"</span></span><span> </span><span class="entity"><span>mrbnf_rep_Ts</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"v'"</span></span><span> </span><span class="entity"><span>mrbnf_rep_Ts</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_equivp_alpha</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_equivp</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_alpha_equivp_tac</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equivp_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_equivp_alpha</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_Quotient</span></span><span> </span><span class="entity"><span>TT_type_definition</span></span><span> </span><span class="entity"><span>equivp_alpha</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Quotient.html#Quotient.Quotient3_to_Quotient_equivp|fact"><span>Quotient3_to_Quotient_equivp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
      </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Quotient.html#Quotient.quot_type.Quotient|fact"><span>quot_type.Quotient</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.type_definition_quot_type|fact"><span>type_definition_quot_type</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
        </span><span class="main"><span>[</span></span><span class="entity"><span>TT_type_definition</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equivp_alpha</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><span>reflexive</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equivp_alpha</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_TT_Quotient</span></span><span> </span><span class="entity"><span>TT_type_definitions</span></span><span> </span><span class="entity"><span>equivp_alphas</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Quotient_abs_reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lifting.html#Lifting.Quotient_abs_rep|fact"><span>Quotient_abs_rep</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lifting.html#Lifting.Quotient_rep_abs|fact"><span>Quotient_rep_abs</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>OF</span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>single</span><span> </span><span>|&gt;</span><span> </span><span>curry</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lifting.html#Lifting.Quotient_total_abs_eq_iff|fact"><span>Quotient_total_abs_eq_iff</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.reflpI|fact"><span>reflpI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define quotient ctor *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>cctor_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>mrbnf_rec_map_As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>mrbnf_rec_map_As</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_cctorN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>cctor_terms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_abs_ctor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>mrbnf_abs_map_As</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span>
      </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>mrbnf_abs_map_As</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_TT_abs_ctor_tac</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span>
          </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 11</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_abs_ctor</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsBs</span></span><span>
      </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_intros_id</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_nchotomy</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>TT_rep</span></span><span> </span><span class="entity"><span>mrbnf_abs_map_As</span></span><span> </span><span class="entity"><span>raw_exhaust</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span>
      </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rep_exhaust</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_rep</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>raw_exhaust</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>mrbnf_abs_map_As</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ct</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_TT_nchotomy_tac</span></span><span> </span><span class="entity"><span>rep_exhaust</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span>
          </span><span class="entity"><span>alpha_quotient_syms</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>mk_exI</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_nchotomys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 12</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_nchotomy</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsBs</span></span><span>
      </span><span class="entity"><span>raw_exhausts</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_intros_id</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define quotient rename *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>rrename_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span class="entity"><span>TT_rep</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_rep</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_rrenameN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>rrename_terms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rrename_cctor</span></span><span> </span><span class="entity"><span>rrename_t</span></span><span> </span><span class="entity"><span>mrbnf_map_BsBs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span>
      </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span class="entity"><span>Quotient_rep_abs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>mrbnf_map_BsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span>RS</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient_rep_abs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rrename_cctor_tac</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
          </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_cctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 13</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rrename_cctor</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsBs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span>
      </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span> </span><span class="entity"><span>alpha_intros_id</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span>
      </span><span class="entity"><span>alpha_bij_eqs</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define quotient FVars *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_FFVars</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>TT_rep</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_rep</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_FFVarsN</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>FFVars_termss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_defss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>define_FFVars</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FFVars_termss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_card_of_FFVars_bound</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="entity"><span>FFVars_def</span></span><span> </span><span class="entity"><span>card_of_FVars_bound</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="comment1"><span>(* TODO: fix for mutual recursion *)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_card_suc</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bd_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>FFVars_def</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span> </span><span>HEADGOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_of_FVars_bound</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_of_FFVars_boundss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_card_of_FFVars_bound</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span>
      </span><span class="entity"><span>FFVars_defss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>card_of_FVars_boundss'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_of_FFVars_boundss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_order</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bd_card_order_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ordIso</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.cardSuc_ordIso_card_suc|fact"><span>cardSuc_ordIso_card_suc</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>card_order</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordIso_symmetric|fact"><span>ordIso_symmetric</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>covar_large</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordIso_ordLeq_trans|fact"><span>ordIso_ordLeq_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ordIso</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>covar_large </span><span class="main"><span>(</span></span><span class="entity"><span>class_thms_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_ordLeq_trans|fact"><span>ordLess_ordLeq_trans</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>covar_large</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>var_large_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="entity"><span>card_of_FFVars_boundss'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FFVars_cctor</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="entity"><span>Quotient_rep_abs</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>free_set</span></span><span>
      </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_Diff</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_UN</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>add_Diff</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>free_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>UNs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_FFVars_cctor_tac</span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span class="entity"><span>Quotient_rep_abs</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FFVars_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span>
          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_map</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FFVars_cctorss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FFVars_cctor</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>b_rels</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="entity"><span>free_setss_Bst</span></span><span> </span><span class="entity"><span>bound_setss_Bst</span></span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FFVars_intros_elims_induct</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="entity"><span>free_sets</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span>
      </span><span class="entity"><span>alpha_FVarss</span></span><span> </span><span class="entity"><span>FFVars_defs</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PTs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>zs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>elim_P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="entity"><span>PTs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"z'"</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_abs_reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_FVarss</span></span><span>
          </span><span class="entity"><span>Quotient_rep_abss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_intros_elim</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="entity"><span>free_set</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span>
          </span><span class="entity"><span>FVars_abs_rep</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>TT_nchotomy</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intro_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_varss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_varss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>varss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>varss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>elim_varss</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_non_mem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span> </span><span>|&gt;</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ws</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>add_non_mem</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>|&gt;</span><span> </span><span>rpair</span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span>#&gt;</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intro_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>intro_concl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_ts</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intro_tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FFVars_intro_tac</span></span><span> </span><span class="entity"><span>FFVars_defs</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>FVars_abs_rep</span></span><span> </span><span class="entity"><span>set_map</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>FVars_intros</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>intros</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>induct_varss</span></span><span> </span><span class="entity"><span>intro_goals</span></span><span> </span><span class="entity"><span>intro_tacs</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>elim_prem</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span>
              </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>elim_P</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>elim_concl</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_ts</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>elim_varss</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>elim_P</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_nchotomy_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>TT_nchotomy</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>elim</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_FFVars_elim_tac</span></span><span> </span><span class="entity"><span>TT_nchotomy_inst</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FFVars_cctorss</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>elim_P</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>elim_goal</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rec_ts</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ts1</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts2</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>induct_concl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>induct_concls</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>induct_varss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>intros</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>elim</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_prems</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>intro_elims</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>induct_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 12</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_intros_elim</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span>
          </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>free_sets</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>(</span></span><span>chop_groups</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rec_live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_intros</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>FVars_abs_reps</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>TT_nchotomys</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span> </span><span>||&gt;</span><span> </span><span>flat</span><span> </span><span>|&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>flat</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_imp</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="entity"><span>z'</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_imp</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>zs'</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>imps</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj_imps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.dummy_pattern</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span> </span><span>|&gt;</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth_map</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dummies</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>imps</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_induct_inst</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="entity"><span>conj_imp</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lifting.html#Lifting.Quotient_total_abs_induct|fact"><span>Quotient_total_abs_induct</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span>
          </span><span class="main"><span>[</span></span><span class="entity"><span>TT_Quotient</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.reflpI|fact"><span>reflpI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_refl</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>thm_instantiate_dummy_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>conj_imp</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct_insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_induct_inst</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>conj_imps</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>intro_elims</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>mk_FFVars_induct_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>induct_insts</span></span><span> </span><span class="entity"><span>FFVars_defs</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>FVars_abs_reps</span></span><span>
            </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span> </span><span class="entity"><span>set_map</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>zs'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>induct_prems</span></span><span> </span><span class="entity"><span>induct_goal</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>FFVars_intross</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_elimss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_inducts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_FFVars_intros_elims_induct</span></span><span>
      </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="entity"><span>free_setss_Bst</span></span><span> </span><span class="entity"><span>bound_setss_Bst</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span>
      </span><span class="entity"><span>alpha_FVarsss</span></span><span> </span><span class="entity"><span>FFVars_defss</span></span><span> </span><span class="entity"><span>FVars_inducts</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span> </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_inject0</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>mrbnf_map_BsBs</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>mr_rel_eq</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span>
      </span><span class="entity"><span>abs_eq_iff</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FFVarsBs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span class="main"><span>)</span></span><span>
              </span><span>#-&gt;</span><span> </span><span class="entity"><span>mk_UNION</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="entity"><span>FFVarsBs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span>
          </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span>
          </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>id</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_map_BsBs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span>
          </span><span>map2</span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="entity"><span>rrename_consts</span></span><span> </span><span class="entity"><span>rrename_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems1</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem0</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rotated_mr_rel_mono_strong0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>6</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Quotient_rel_reps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lifting.html#Lifting.Quotient_rel_rep|fact"><span>Quotient_rel_rep</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>TT_Quotients</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_sym_transs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_TT_inject0_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span> </span><span class="entity"><span>mr_rel_eq</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>abs_eq_iff</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span>
          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FFVars_defss</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><span>symmetric</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span>
          </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="entity"><span>Quotient_rel_reps</span></span><span> </span><span class="entity"><span>rotated_mr_rel_mono_strong0</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span>
          </span><span class="entity"><span>alpha_sym_transs</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_injects0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 14</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_inject0</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsBs</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span>
      </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>mr_rel_eqs</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>set_maps</span></span><span>
      </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span> </span><span class="entity"><span>alpha_intros</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Define quotient avoid *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>aavoid_terms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>aavoid_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>avoid_t</span></span><span> </span><span class="entity"><span>mrbnf_map_AsBs</span></span><span> </span><span class="entity"><span>mrbnf_map_BsAs</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>mrbnf_map_AsBs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rep_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>mrbnf_map_BsAs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span class="entity"><span>abs_map</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>avoid_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rep_map</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>new_definition</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_aavoidN</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rhs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>avoidsAs</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsBs</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;&gt;</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aavoidsAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>aavoid_terms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_aavoid_term</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>set_t</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inter</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>map2</span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>f</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_aavoid</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>aavoid_t</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>aavoid_def</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>avoid_freshs</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>set_map</span></span><span>
      </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>alpha_intro_id</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_avoid</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_aavoid_term</span></span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aavoid_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_aavoid_tac</span></span><span> </span><span class="entity"><span>aavoid_def</span></span><span> </span><span class="entity"><span>cctor_def</span></span><span> </span><span class="entity"><span>map_comp</span></span><span> </span><span class="entity"><span>TT_Quotient</span></span><span> </span><span class="entity"><span>set_map</span></span><span> </span><span class="entity"><span>mr_rel_map</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
          </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>rel_refl_id</span></span><span> </span><span class="entity"><span>avoid_freshs</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>alpha_intro_id</span></span><span>
          </span><span class="entity"><span>alpha_avoid</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>v</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>split_Nconjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fbound</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aavoid_freshss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_aavoids</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 16</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_aavoid</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>aavoidsAs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span> </span><span class="entity"><span>aavoid_defs</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span>
      </span><span class="entity"><span>avoid_freshss</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span>
      </span><span class="entity"><span>alpha_intros_id</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_avoids</span></span><span>
      </span><span>|&gt;</span><span> </span><span>map_split</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>##&gt;</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_TT_fresh_cases</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>TT_nchotomy</span></span><span> </span><span class="entity"><span>alpha_aavoid</span></span><span> </span><span class="entity"><span>aavoid_freshs</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_sym_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>chop</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>#&gt;&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.dest_eq</span></span><span> </span><span>o</span><span> </span><span>the_single</span><span>
          </span><span>#&gt;</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_aavoid_term</span></span><span> </span><span class="entity"><span>mk_sym_term</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insert_nchotomy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>TT_nchotomy</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_TT_fresh_cases_tac</span></span><span> </span><span class="entity"><span>insert_nchotomy</span></span><span> </span><span class="entity"><span>alpha_aavoid</span></span><span> </span><span class="entity"><span>aavoid_freshs</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_fsets</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.conj_imp_eq_imp_imp|fact"><span>conj_imp_eq_imp_imp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_fresh_cases</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_nchotomys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_TT_fresh_cases</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span>
      </span><span class="entity"><span>bound_setss_Bs</span></span><span> </span><span class="entity"><span>TT_nchotomys</span></span><span> </span><span class="entity"><span>alpha_aavoids</span></span><span> </span><span class="entity"><span>aavoid_freshss</span></span><span> </span><span>|&gt;</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_noclashs</span></span><span> </span><span class="entity"><span>FVarsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"noclash_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>short_type_name</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>FVars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVarsss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_free_UNss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UNs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>UNs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>UNss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mk_free_UNs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>mk_free_UNs</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span> </span><span class="entity"><span>mk_free_UNss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>rhss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_def_t</span></span><span> </span><span>true</span><span> </span><span>Binding.empty</span><span> </span><span>I</span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>rhs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noclashs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_noclashs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>free_setss_Ast</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_setss_Ast</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nnoclashs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_noclashs</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>free_setss_Bst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_setss_Bst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noclashs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>noclashs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>noclashs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_prod</span></span><span>
          </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>noclashs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nnoclash_noclashs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>nnoclash</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>nnoclash</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>noclashs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>nnoclashs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>FFVars_defss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span> </span><span class="entity"><span>noclashs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_existential_co_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_co_induct_param</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_induct_param_no_clash_opt</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>subshapess_opt</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>TT_subshape_induct_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wf_subshape_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshape_rel_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_subshape_imagesss_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_subshapesss_opt</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>TT_fresh_co_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_plain_co_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>co</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="comment1"><span>(* Define coinductive predicate alpha' *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha's_invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'sAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*alpha's*)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_alpha'N</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>quiet_mode </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> verbose </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> alt_name </span><span class="main"><span>=</span></span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span>
                coind </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> no_elim </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_ind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> skip_mono </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span>oo</span><span> </span><span>pair</span><span> </span><span>o</span><span> </span><span>Binding.name_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_term</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FVarsBs</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_sets</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bound_set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_set</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_zips</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>)</span></span><span>
                        </span><span>#-&gt;</span><span> </span><span class="entity"><span>mk_UNION</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>b_rels</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bound_minus</span></span><span> </span><span class="entity"><span>bound_set</span></span><span class="main"><span>)</span></span><span>
                        </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_UNION_term</span></span><span> </span><span class="entity"><span>bound_sets</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FVarsBs</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FVarsBs</span></span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>;</span></span><span>

                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>alpha'_ts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fids</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fids</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span>
                    </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>split_list</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span>
                      </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>@</span><span>
                    </span><span>replicate</span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem0</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span>@</span><span>
                    </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv</span></span><span> </span><span>#&gt;</span><span> </span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span>
                    </span><span>map2</span><span> </span><span class="entity"><span>mk_rec_rel</span></span><span> </span><span class="entity"><span>recs_consts</span></span><span> </span><span class="entity"><span>rename_args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                  </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>prems1</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span>
                    </span><span class="main"><span>(</span></span><span class="entity"><span>prems2</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>add_prems</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>]</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>add_prems</span></span><span> </span><span class="entity"><span>ffs</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>terms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_term</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>alpha'_ts</span></span><span> </span><span class="entity"><span>bound_setss_As</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span>
                </span><span class="entity"><span>mrbnf_rels_AsAs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mono</span></span><span> </span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mr_rel_mono</span></span><span> </span><span>OF</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>monos</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_mono</span></span><span> </span><span class="entity"><span>mr_rel_monos</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.conj_context_mono|fact"><span>conj_context_mono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>Inductive.add_inductive</span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NoSyn</span><span> </span><span>oo</span><span> </span><span>pair</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>Binding.empty_atts</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>monos</span></span><span>
                </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>invar_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inductive.transform_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha'_ts</span></span><span> </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_freesAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>induct </span><span class="entity"><span>alpha's_invar_result</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_elims</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>elims </span><span class="entity"><span>alpha's_invar_result</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_bij_eq_invs</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
                </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span> </span><span>o</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_coinduct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha'_coinduct</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>meta_mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imp_forward</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>hd</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
                  </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>hd</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>,</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
                  </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>,</span></span><span> </span><span>hd</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Meson.html#Meson.imp_forward|fact"><span>imp_forward</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Drule.rearrange_prems</span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>g</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exIs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha'_bij_eq_invs_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>alpha'_coinduct_inst</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>mk_exIs</span></span><span> </span><span class="entity"><span>mutual</span></span><span>
              </span><span class="entity"><span>imp_forward</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span>
              </span><span class="entity"><span>alpha'_elims</span></span><span> </span><span class="entity"><span>raw_nchotomys</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>set_maps</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha'_bij_eq_inv'</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>alpha'_bij_eq_inv</span></span><span> </span><span class="entity"><span>rename_id</span></span><span>
            </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inv_rename</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rename</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inv_rename</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_cong_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inv_rename</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rename</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inv_rename</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha'_bij_eq_inv</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha'_bij_eq_inv'_tac</span></span><span> </span><span class="entity"><span>arg_cong_inst</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_bij_eq_inv's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha'_bij_eq_inv'</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span>
            </span><span class="entity"><span>alpha'_bij_eq_invs</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha'_FVars_les</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span> </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>set_transfers</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>FVars_ts</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha_FVars_les_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span>false</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rec_live</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'_bij_eq_invs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>FVars_induct</span></span><span> </span><span class="entity"><span>alpha'_elims</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>set_transfers</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_FVars_less</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zip_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>zip_opt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>xs</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_bound_sett</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span class="entity"><span>free_setts</span></span><span> </span><span class="entity"><span>bound_setts</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span>`</span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>bound_setts</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>apsnd</span><span> </span><span>o</span><span> </span><span>K</span><span class="main"><span>)</span></span><span>
                  </span><span>|-&gt;</span><span> </span><span class="entity"><span>map_binding_vector</span></span><span> </span><span class="entity"><span>b_vec</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>zip_opt</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>::</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_setts</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>transpose</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_transferss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_bound_sett</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>free_settss</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span>
                </span><span class="entity"><span>binding_matrix</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha'_FVars_les</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span> </span><span class="entity"><span>FVars_inducts</span></span><span> </span><span class="entity"><span>set_transferss</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_imp_alpha's</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha_imp_alpha's_tac</span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>alpha'_coinduct</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
                </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.spec2|fact"><span>spec2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha'_imp_alphas</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha'_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha'_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>alpha'sAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>::</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>bound_settss</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map_product</span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>filter_like</span></span><span> </span><span class="entity"><span>bs</span></span><span> </span><span>I</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>rec_settss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>binding_matrix</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>g</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>h</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_arg_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha'_imp_alphas_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>alpha_coinduct</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>mk_arg_congs</span></span><span> </span><span class="entity"><span>mutual</span></span><span>
                </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha'_bij_eq_invs</span></span><span> </span><span class="entity"><span>alpha'_bij_eq_inv's</span></span><span>
                </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>alpha'_FVars_less</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>alpha'_elims</span></span><span>
                </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span> </span><span class="entity"><span>settss</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>split_conjs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.spec2|fact"><span>spec2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_alpha's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span>
            </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iff_conv_conj_imp|fact"><span>iff_conv_conj_imp</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>alpha_imp_alpha's</span></span><span> </span><span class="entity"><span>alpha'_imp_alphas</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Rs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"R"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>paramT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>)</span></span><span>
            </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"S"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_existential_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span>
                </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>us</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>us'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"u"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span>
                </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"u'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="entity"><span>u'</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u'</span></span><span class="main"><span>]</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>u</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u'</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>mrbnf_rels_BsBs</span></span><span> </span><span class="entity"><span>us</span></span><span> </span><span class="entity"><span>us'</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rep_eq</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rep_meta_mp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rep_eq</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>Ss</span></span><span>
                </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>meta_mp</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_abs_rel</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="entity"><span>TT_abs</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_disj</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_abs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_abs_rel</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_abs_meta_mp</span></span><span> </span><span class="entity"><span>mrbnf_map_BsAs</span></span><span> </span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="entity"><span>abs_rels</span></span><span> </span><span class="entity"><span>mrbnf_rel_AsAs</span></span><span> </span><span>$</span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>mrbnf_map_BsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>mrbnf_map_BsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>meta_mp</span></span><span> </span><span>|&gt;</span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs_meta_mps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_abs_meta_mp</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsAs</span></span><span> </span><span class="entity"><span>mrbnf_rels_AsAs</span></span><span>
                </span><span class="entity"><span>mrbnf_rels_BsBs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_allE</span></span><span> </span><span class="entity"><span>TT_rep</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_rep</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span>
                </span><span class="entity"><span>allE</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>allE_insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_allE</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_TT_existential_coinduct_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plive</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>rec_live</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>rep_meta_mp</span></span><span>
                </span><span class="entity"><span>Quotient_abs_reps</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>allE_insts</span></span><span>
                </span><span class="entity"><span>alpha_alpha's</span></span><span> </span><span class="entity"><span>alpha'_coinduct</span></span><span> </span><span class="entity"><span>raw_nchotomys</span></span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span>
                </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>abs_meta_mps</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong_ids</span></span><span> </span><span class="entity"><span>mr_rel_mono_strong0s</span></span><span>
                </span><span class="entity"><span>mr_le_rel_OOs</span></span><span> </span><span class="entity"><span>mr_rel_flips</span></span><span> </span><span class="entity"><span>mutual</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_fresh_coinduct_param</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bex_rho_param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>mk_Bex</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bex_Rww'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>bex_rho_param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bex_Rww'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_not_varsOf</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_not_varsOfs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_not_varsOf</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>varsOf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_bex_Rww'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span>I</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>plive</span></span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span>
                </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>pbound</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_not_varsOfs</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ideqs</span></span><span> </span><span class="entity"><span>rels</span></span><span> </span><span class="entity"><span>mrbnf_rel_BsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span>
                </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>mrbnf_rels_BsBs</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>Rs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_TT_fresh_coinduct_param_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>TT_existential_coinduct</span></span><span> </span><span class="entity"><span>TT_fresh_cases</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Rs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>hyps</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_fresh_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>paramT</span></span><span> </span><span>::</span><span>
            </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>S</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span>
              </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ss</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Ss</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>TT_fresh_coinduct_param</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>full_simplify</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_plain_coinduct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_fresh_coinduct</span></span><span> </span><span>OF</span><span>
            </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id|fact"><span>supp_id</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>full_simplify</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>mutual</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
            </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.spec2|fact"><span>spec2</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>TT_existential_coinduct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>TT_fresh_coinduct_param</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span>
            </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>TT_fresh_coinduct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>after_qed</span></span><span> </span><span class="entity"><span>TT_plain_coinduct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="comment1"><span>(* Define inductive predicate subshape *)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_subshape</span></span><span> </span><span class="entity"><span>name2</span></span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>name1</span></span><span> </span><span class="entity"><span>CA1</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subshapeN</span></span><span> </span><span class="entity"><span>name1</span></span><span> </span><span class="entity"><span>name2</span></span><span> </span><span>|&gt;</span><span> </span><span>Binding.name</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>CA1</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>quiet_mode </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> verbose </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> alt_name </span><span class="main"><span>=</span></span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span>
                coind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_elim </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> no_ind </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> skip_mono </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prem2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span>bot</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>prem1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prem2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>new_lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>|&gt;</span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span>|&gt;</span><span> </span><span>snd</span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>Inductive.add_inductive</span></span><span> </span><span class="entity"><span>inductive_flags</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span>Binding.empty_atts</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>term</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                </span><span>||&gt;</span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>invar_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Inductive.transform_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>invar_result_raw</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_subshapeAs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span>
                </span><span>|&gt;</span><span> </span><span>`</span><span class="main"><span>(</span></span><span class="entity"><span>subst_terms</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span>|&gt;</span><span> </span><span>singleton</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>invar_result</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshape_subshapeAs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>new_lthy</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_subshapes</span></span><span> </span><span class="entity"><span>name2</span></span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>split_list</span><span> </span><span>##&gt;</span><span> </span><span>split_list</span><span class="main"><span>)</span></span><span> </span><span>oo</span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>define_subshape</span></span><span> </span><span class="entity"><span>name2</span></span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>subshape_invar_resultss</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subshapessAs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*subshapess*)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>define_subshapes</span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span class="main"><span>)</span></span><span>
              </span><span class="entity"><span>lthy</span></span><span> </span><span>|&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>split_list</span><span> </span><span>o</span><span> </span><span>split_list</span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_elimss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>elims </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshape_invar_resultss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_intross</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>the_single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>intrs </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshape_invar_resultss</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_induct_raw</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp_prem</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_hyp_prem</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>subshapessAs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_common_co_induct_inst</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>hs</span></span><span> </span><span class="entity"><span>g_opts</span></span><span> </span><span class="entity"><span>prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>g_opt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>h</span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>g_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>f</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>g</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>g_opts</span></span><span> </span><span class="entity"><span>hs</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>Object_Logic.rulify</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prem</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>hs</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>hs</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_prem_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_comp</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>rename_comp</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map_all_no_binding</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>all_bindings</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>b1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>b2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rename_comps</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_comp</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>o</span><span> </span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>map_all_no_binding</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_rename_comp_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_rename_comps</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sett</span></span><span> </span><span class="entity"><span>sett</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sett</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rel_funD</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_rec_lives</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_sett</span></span><span> </span><span>o</span><span> </span><span>take</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>o</span><span> </span><span>drop</span><span>
                </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span>+</span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>settss</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq_inv</span></span><span> </span><span class="entity"><span>alpha_bij_eq_inv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>alpha_bij_eq_inv</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_alpha_bij_eq_inv</span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_subshape_induct_raw_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span>
                </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>mk_prem_funs</span></span><span> </span><span class="entity"><span>mk_rename_comp_funs</span></span><span>
                </span><span class="entity"><span>common_co_induct_inst</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>subshape_elimss</span></span><span>
                </span><span class="entity"><span>settsss</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_induct</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp_prem</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_hyp_prem</span></span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span> </span><span>@</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_hyp</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>subshapessAs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_induct_raw_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>subshape_induct_raw</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>meta_spec_ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>meta_spec</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spec_ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_subshape_induct_tac</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>subshape_induct_raw_inst</span></span><span> </span><span class="entity"><span>meta_spec_ys</span></span><span> </span><span class="entity"><span>spec_ys</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
                </span><span class="entity"><span>alpha_refls</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>hyps</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sumT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>BNF_Util.mk_sumT</span></span><span> </span><span class="entity"><span>CAs</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_rel</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.Collect_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sumT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sumT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sumT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t'"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sumT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>BNF_FP_Util.mk_case_sumN</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subshapes</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CA1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>BNF_FP_Util.mk_case_sumN</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subshape</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>CA2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="entity"><span>subshape</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>subshapes</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>subshapessAs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wf_subshape</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Wellfounded.html#Wellfounded.wf_on|const"><span>wf_on</span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="entity"><span>sumT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sumT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sumT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>sumT</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>wf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>subshape_rel</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sumE_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>split_last</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>BNF_GFP_Util.mk_sumEN</span></span><span> </span><span class="entity"><span>n</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Wellfounded.html#Wellfounded.wf_def|fact"><span>wf_def</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.prod_in_Collect_iff|fact"><span>prod_in_Collect_iff</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>sumE_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>ALLGOALS</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_induct'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>inj</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>inj</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_sum_ctors</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshape_induct</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Rec_Sugar_Util.mk_conjunctN</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>subshape_induct'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impE</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>sumE_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Sum_Type.html#Sum_Type.sum.case|fact"><span>sum.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_subshape_images</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span> </span><span class="entity"><span>set_ts</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>ctor_t</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>subshape_intros</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_set_subshape_image</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>set_t</span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>CA</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>set_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prem_terms_ffs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>mk_set_subshape_image_tac</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>subshape_intros</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span>
                </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_subshape_image</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>CAs</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>set_ts</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>set_ts</span></span><span class="main"><span>,</span></span><span> </span><span>drop</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>set_ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>set_ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>ks</span></span><span> </span><span class="entity"><span>subshape_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_subshape_imagesss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_set_subshape_images</span></span><span> </span><span class="entity"><span>subshapessAs</span></span><span> </span><span class="entity"><span>rec_setss_As</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>xs</span></span><span>
              </span><span class="entity"><span>subshape_intross</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_subshapesss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span>::</span><span class="entity"><span>rename_id0s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ffs</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_subshape_imagesss</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_subshape</span></span><span> </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="entity"><span>CA1</span></span><span> </span><span class="entity"><span>CA2</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span>
            </span><span class="entity"><span>mk_subshape_intros</span></span><span> </span><span class="entity"><span>mk_alpha_bij_eqs</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span class="entity"><span>subshape_elim</span></span><span> </span><span class="entity"><span>setts</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>CA1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span>||&gt;</span><span> </span><span>fst</span><span> </span><span>o</span><span> </span><span>yield_singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CA2</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>hd</span><span> </span><span class="entity"><span>ys</span></span><span> </span><span>||&gt;</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span>tl</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y3</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshape_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y3</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y2</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_alpha_subshape_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span>
                </span><span class="entity"><span>mk_subshape_intros</span></span><span> </span><span class="entity"><span>mk_alpha_bij_eqs</span></span><span> </span><span class="entity"><span>setts</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="entity"><span>subshape_elim</span></span><span> </span><span class="entity"><span>raw_injects</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ys</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y3</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_subshapes</span></span><span> </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="entity"><span>CA</span></span><span> </span><span class="entity"><span>subshape_intros</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subshape_intro</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_opts</span></span><span> </span><span class="entity"><span>subhsape_intro</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f_opt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>f_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>g</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_opts</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subhsape_intro</span></span><span> </span><span>OF</span><span>
                </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_UnIN</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subshape_intros</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_subshape_intro</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>k_ranges</span></span><span>
                </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>subshape_intros</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_subshape_intro_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_subshape_intros</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>some_bindings</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_bindings</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eqs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_alpha_bij_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span>
                </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span>o</span><span> </span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>|-&gt;</span><span> </span><span class="entity"><span>transpose</span></span><span> </span><span>oo</span><span> </span><span class="entity"><span>map_binding_matrix</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>some_bindings</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>dest_rec_lives</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_alpha_bij_eqs</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_alpha_subshape</span></span><span> </span><span class="entity"><span>supp_comp_bound</span></span><span> </span><span class="entity"><span>alpha_t</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="entity"><span>CA</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span>
                </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>mk_subshape_intro_funs</span></span><span> </span><span class="entity"><span>mk_alpha_bij_eq_funs</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_subshapess</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_sett</span></span><span> </span><span class="entity"><span>sett</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sett</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>rel_funD</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>settsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_rec_lives</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_sett</span></span><span> </span><span>o</span><span> </span><span>take</span><span> </span><span class="entity"><span>rec_live</span></span><span> </span><span>o</span><span> </span><span>drop</span><span>
                </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span>+</span><span class="entity"><span>passive</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>settss</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha_subshapes</span></span><span> </span><span class="entity"><span>supp_comp_bounds</span></span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>subshape_intross</span></span><span>
                </span><span class="entity"><span>subshapessAs</span></span><span> </span><span class="entity"><span>subshape_elimss</span></span><span> </span><span class="entity"><span>settsss</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"P"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>paramT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>)</span></span><span>
            </span><span class="entity"><span>frees_lthy</span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_existential_induct</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ball_rho_param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_ball_Pw</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>ball_rho_param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_ball_Pw</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>list_all_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>list_exists_free</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>oo</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>ball_rho_param</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Pws</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_ball_Pw</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj_Pws</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dummies</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.dummy_pattern</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span> </span><span>|&gt;</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>nth_map</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dummies</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Pws</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_dummy_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span>
                </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg_cong</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD1</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj_arg_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>conj_Pws</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>TT_Quotients</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>Pws</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_induct_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>ys</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_ball_Pw</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>|&gt;</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshape_induct</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exE</span></span><span> </span><span class="entity"><span>mrbnf_map_AsBs</span></span><span> </span><span class="entity"><span>assm</span></span><span> </span><span class="entity"><span>rho</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>exE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>SOME</span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>mrbnf_map_AsBs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>assm</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_exE_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_exE</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsBs</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_subshapess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>OF</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_subshapess</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_alpha_trans</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_intro_id</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>TT_abss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_map_AsAs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_intro_id</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_alpha_trans_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_alpha_trans</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span>
                </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_intros_id</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subshape_intro_id</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>k</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subhsape_intro</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subhsape_intro</span></span><span> </span><span>OF</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_UnIN</span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subshape_intross_id</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="entity"><span>mk_subshape_intro_id</span></span><span> </span><span class="entity"><span>k_ranges</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>subshape_intross</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_TT_existential_induct_tac</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="entity"><span>subshape_induct_inst</span></span><span>
                </span><span class="entity"><span>conj_arg_congs</span></span><span> </span><span class="entity"><span>arg_congs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rec_lives</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>raw_exhausts</span></span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span> </span><span class="entity"><span>mk_exE_funs</span></span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>map_comps</span></span><span> </span><span class="entity"><span>mr_rel_maps</span></span><span> </span><span class="entity"><span>set_maps</span></span><span>
                </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="entity"><span>mr_rel_refl_ids</span></span><span> </span><span class="entity"><span>alpha_subshapess</span></span><span> </span><span class="entity"><span>mk_alpha_trans_funs</span></span><span>
                </span><span class="entity"><span>subshape_intross_id</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_fresh_induct_param</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem1</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_varsOf_imp</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem2</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span>
                </span><span class="entity"><span>sets</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_varsOf_imp</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ball_rho_param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_prem1</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span>@</span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem2</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>oo</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>ball_rho_param</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>aavoid_freshss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>o</span><span> </span><span>map</span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Int_emptyD|fact"><span>Int_emptyD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>aavoid_freshss</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>aavoid_t</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>rho</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>aavoid_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>SOME</span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>exI</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_exI_funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_exI</span></span><span> </span><span class="entity"><span>aavoidsAs</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_TT_fresh_induct_param_tac</span></span><span> </span><span class="entity"><span>TT_existential_induct</span></span><span> </span><span class="entity"><span>mk_exI_funs</span></span><span> </span><span class="entity"><span>alpha_aavoids</span></span><span>
                </span><span class="entity"><span>aavoid_freshss</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_fresh_induct_param_no_clash</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem1</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_bound</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_varsOf_imp</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_free_set_imp</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_non_clash_imp</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_not</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_imps</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>bvec</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_varsOf_imp</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>varsOf</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>mk_free_set_imp</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>fset</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_non_clash_imp</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>bset</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>filter_like</span></span><span> </span><span class="entity"><span>bvec</span></span><span> </span><span>not</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_prem2</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="entity"><span>cctor</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_prem_imp</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>ws</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_rec_lives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imps</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span class="entity"><span>bsets</span></span><span>
                  </span><span class="entity"><span>binding_matrix</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span>
                  </span><span class="main"><span>[</span></span><span>fst</span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cctor</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span> </span><span>|&gt;</span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ball_rho_param</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span> </span><span>#&gt;</span><span> </span><span class="entity"><span>mk_Ball</span></span><span> </span><span class="entity"><span>param</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_prem1</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span>@</span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_prem2</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span> </span><span class="entity"><span>free_setss_Bs</span></span><span> </span><span class="entity"><span>bound_setss_Bs</span></span><span> </span><span class="entity"><span>rec_setss_Bs</span></span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>oo</span><span> </span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_conjs</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>ball_rho_param</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Sprod_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="entity"><span>mk_Sigma_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_union_t</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>varsOf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>::</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>ws</span></span><span>
                </span><span>|&gt;</span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_union</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>fold_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>union_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="entity"><span>mk_union_t</span></span><span> </span><span class="entity"><span>varsOfs</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_imp_t</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>w'</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>fold_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rho</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>w'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imp_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_imp_t</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>ws'</span></span><span> </span><span class="entity"><span>Ps</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>meta_mp_inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>meta_mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>Sprod_t</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>union_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imp_ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_fresh_induct_param</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UNIV_Is</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm_instantiate_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>UNIV_I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>rev</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>mk_TT_fresh_induct_param_no_clash_tac</span></span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span> </span><span class="entity"><span>meta_mp_inst</span></span><span> </span><span class="entity"><span>UNIV_Is</span></span><span>
                </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>card_of_FFVars_boundss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Un_bounds</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FFVars_cctorss</span></span><span class="main"><span>)</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>param</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>Ps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>varsOfs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="entity"><span>goal</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_fresh_induct</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Qs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"Q"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>CB</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>CBs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>frees_lthy</span></span><span> </span><span>|&gt;</span><span> </span><span>fst</span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>paramT</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>rho</span></span><span> </span><span>|&gt;</span><span> </span><span>absfree</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span>
                </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>absfree</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rho</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>$</span><span> </span><span>o</span><span> </span><span>rpair</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>Qs</span></span><span>
                </span><span>|&gt;</span><span> </span><span>map</span><span> </span><span>SOME</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
              </span><span class="entity"><span>thm_instantiate_fixed_terms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fsets</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Qs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_fresh_induct_param_no_clash</span></span><span>
                </span><span>|&gt;</span><span> </span><span class="entity"><span>full_simplify</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TT_plain_induct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TT_fresh_induct</span></span><span> </span><span>OF</span><span>
            </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id|fact"><span>supp_id</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="entity"><span>full_simplify</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>TT_existential_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_induct_param</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>TT_fresh_induct_param_no_clash</span></span><span class="main"><span>,</span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>subshapessAs</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>subshape_induct</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>wf_subshape</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>subshape_rel</span></span><span class="main"><span>,</span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>set_subshape_imagesss</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>set_subshapesss</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>TT_fresh_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_plain_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rrename_ids</span></span><span> </span><span class="entity"><span>rrename_t</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>Quotient_abs_rep</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fids</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rrename_id_tac</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>Quotient_abs_rep</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove_no_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rrename_ids</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span>
      </span><span class="entity"><span>Quotient_abs_reps</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_id0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.meta_eq_to_obj_eq|fact"><span>meta_eq_to_obj_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
      </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.abs_def_rule</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rrename_ids</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rrename_comps</span></span><span> </span><span class="entity"><span>rrename_t</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iff</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span>
      </span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span class="entity"><span>alpha_quotient_sym</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fgs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fgs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs_fgs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_rrename_comp_tac</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iff</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span>
            </span><span class="entity"><span>alpha_bij_eq</span></span><span> </span><span class="entity"><span>alpha_quotient_sym</span></span><span> </span><span class="entity"><span>rename_comp</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rrename_comps</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span>
      </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_comp0s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_rename_comp0s</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>rrename_comps</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_rrename_cong_id</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>rrename_t</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span class="entity"><span>FFVars_defs</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>Quotient_abs_rep</span></span><span>
      </span><span class="entity"><span>Quotient_total_abs_eq_iff</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span> </span><span class="entity"><span>rename_id</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>z</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>z</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_eq</span></span><span> </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>zs</span></span><span> </span><span class="entity"><span>FFVars_ts</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span>
          </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>|&gt;</span><span> </span><span>foldr1</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_thms</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rename_id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>id_apply</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_bij</span></span><span> </span><span>OF</span><span>
          </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span>*</span><span class="entity"><span>fbound</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>|&gt;</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>mk_rrename_cong_id_tac</span></span><span> </span><span class="entity"><span>FFVars_defs</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>Quotient_abs_rep</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iff</span></span><span>
          </span><span class="entity"><span>alpha_bij</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ws</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_cong_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>mk_rrename_cong_id</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVars_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>Quotient_abs_reps</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span>
      </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_bijs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_bij</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>rrename_comp0s</span></span><span> </span><span class="entity"><span>rrename_id0s</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rrename_inv_simps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_rename_inv_simp</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>rrename_comp0s</span></span><span> </span><span class="entity"><span>rrename_id0s</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_FFVars_rrename</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="entity"><span>rrename_t</span></span><span> </span><span class="entity"><span>rrename_def</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span> </span><span class="entity"><span>alpha_quotient_sym</span></span><span> </span><span class="entity"><span>FVars_rename</span></span><span> </span><span class="entity"><span>FFVars_t</span></span><span> </span><span class="entity"><span>FFVars_def</span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rrename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FFVars_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>Ctr_Sugar_Tactics.unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rrename_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_def</span></span><span class="main"><span>]</span></span><span> </span><span>THEN</span><span>
          </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>alpha_quotient_sym</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>FVars_rename</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FFVars_rrenamess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_FFVars_rrename</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ws</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>ffs</span></span><span> </span><span class="entity"><span>FVars_renamess</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span> </span><span class="entity"><span>FFVars_defss</span></span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cctor_eq_intro_rrenames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>iffD2</span></span><span class="main"><span>)</span></span><span>
      </span><span>|&gt;</span><span> </span><span>funpow</span><span> </span><span class="entity"><span>fbound</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exI</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_conjIN</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>3</span></span><span>*</span><span class="entity"><span>fbound</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>TT_injects0</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_noclash_rename</span></span><span> </span><span class="entity"><span>renames</span></span><span> </span><span class="entity"><span>FVars_renames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comb_mrbnf_term</span></span><span> </span><span class="entity"><span>ffs_ids</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ffs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>renames</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ffs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prem_terms_ffs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>noclash</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>FVars_renames</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.image_UN|fact"><span>image_UN</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_Int|fact"><span>image_Int</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_is_empty|fact"><span>image_is_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>noclash_renames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_noclash_rename</span></span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_maps_AsAs</span></span><span> </span><span class="entity"><span>noclashs</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nnoclash_rrenames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_noclash_rename</span></span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>FFVars_rrenamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_maps_BsBs</span></span><span> </span><span class="entity"><span>nnoclashs</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* TODO: use giant map instead of x times (nth ... i) *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_ress</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quot_ress</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>nth_opt</span></span><span> </span><span class="entity"><span>xs_opt</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.mapPartial</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs_opt</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_fp_res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
          T </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>CAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          ctor </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>ctorsAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>renamesAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FVarsssAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          noclash </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>noclashs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

          inject </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>raw_injects</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          noclash_rename </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>noclash_renames</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_id0 </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_id0s</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_id </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_ids</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_comp0 </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_comp0s</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_comp </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_comps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_bij </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_bijs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_inv_simp </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_inv_simps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_ctors </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_renames </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_intross </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>,</span></span><span>
          card_of_FVars_bounds </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>card_of_FVars_boundss'</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          card_of_FVars_bound_UNIVs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>card_of_FVars_boundss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          inner </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
            alpha </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alphasAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            subshape_rel </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>subshape_rel_opt</span></span><span class="main"><span>,</span></span><span>

            exhaust </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>raw_exhausts</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            rename_simp </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rename_simps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

            alpha_refl </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_refls</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_sym </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_syms</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_trans </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_transs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_bij </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_bijs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_bij_eq </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_FVarss </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_intro </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_intros</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_elim </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_elims</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

            subshapes </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nth_opt</span></span><span> </span><span class="entity"><span>subshapess_opt</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            wf_subshape </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>wf_subshape_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(* TODO: do not duplicate this *)</span></span><span>
            set_subshapess </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nth_opt</span></span><span> </span><span class="entity"><span>set_subshapesss_opt</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            set_subshape_imagess </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nth_opt</span></span><span> </span><span class="entity"><span>set_subshape_imagesss_opt</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            subshape_induct </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_subshape_induct_opt</span></span><span>
          </span><span class="main"><span>}</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quotient_fp_res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
          T </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>CBs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          ctor </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>cctorsAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrenamesAs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVarsssAs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          noclash </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>nnoclashs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

          inject </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>TT_injects0</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          noclash_rename </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>nnoclash_rrenames</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_id0 </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_id0s</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_id </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_ids</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_comp0 </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_comp0s</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_comp </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_comps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_bij </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_bijs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          rename_inv_simp </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_inv_simps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_ctors </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVars_cctorss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_renames </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVars_rrenamess</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          FVars_intross </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>FFVars_intross</span></span><span class="main"><span>,</span></span><span>
          card_of_FVars_bounds </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>card_of_FFVars_boundss'</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          card_of_FVars_bound_UNIVs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>card_of_FFVars_boundss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
          inner </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
            abs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>TT_abss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            rep </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>TT_reps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

            ctor_def </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>cctor_defs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            rename_def </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_defs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            FVars_defs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>FFVars_defss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

            nnoclash_noclash </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>nnoclash_noclashs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            alpha_quotient_sym </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            total_abs_eq_iff </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            abs_rep </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Quotient_abs_reps</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            rep_abs </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            abs_ctor </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>

            rename_ctor </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_cctors</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            rename_cong_id </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>rrename_cong_ids</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span>
            fresh_co_induct_param </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_fresh_co_induct_param</span></span><span class="main"><span>,</span></span><span>
            fresh_co_induct </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_fresh_co_induct</span></span><span class="main"><span>,</span></span><span>
            fresh_induct_param_no_clash </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TT_fresh_induct_param_no_clash_opt</span></span><span>
          </span><span class="main"><span>}</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>raw_fp_res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quotient_fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
      fp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span>
      binding_relation </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>,</span></span><span>
      rec_vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ks</span></span><span class="main"><span>,</span></span><span>
      raw_fps </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>raw_ress</span></span><span class="main"><span>,</span></span><span>
      quotient_fps </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quot_ress</span></span><span class="main"><span>,</span></span><span>
      pre_mrbnfs </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span>
    </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>register_fp_results</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>res</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>lthy</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_simps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_simps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_id0s"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_id0s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_ids"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_comp0s"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_comp0s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_comps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_comps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_bijs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_bijs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rename_inv_simps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rename_inv_simps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_ctors"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FVars_ctorss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_rename_less"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FVars_rename_less</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_renames"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FVars_renamess</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"card_of_FVars_bounds"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>card_of_FVars_boundss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_refls"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_refls</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_bijs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_bijs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_bij_eqs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_bij_eqs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_bij_eq_invs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_bij_eq_invs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_FVarss"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>alpha_FVarsss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_syms"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_syms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_transs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_transs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_elims"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_elims</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"card_of_FVarsB_bounds"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>card_of_FVarsB_boundss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"refresh_sets"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refresh_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"refreshs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>refreshs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"avoid_freshs"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>avoid_freshss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_avoids"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_avoids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"equivp_alphas"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equivp_alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"nnoclash_noclashs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnoclash_noclashs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"nnoclash_rrenames"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnoclash_rrenames</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"noclash_renames"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>noclash_renames</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_Quotients"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_Quotients</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_alpha_quotient_syms"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_quotient_syms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_Quotient_total_abs_eq_iffs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient_total_abs_eq_iffs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_Quotient_abs_reps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient_abs_reps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_Quotient_rep_abss"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Quotient_rep_abss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_abs_ctors"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_abs_ctors</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_nchotomys"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_nchotomys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_cctors"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_cctors</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"card_of_FFVars_bounds"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>card_of_FFVars_boundss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_bd"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>card_of_FFVars_boundss'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_cctors"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FFVars_cctorss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_intros"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FFVars_intross</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_intros"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_elims"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FFVars_elimss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_inducts"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FFVars_inducts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FFVars_rrenames"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FFVars_rrenamess</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_injects0"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_injects0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"aavoid_freshs"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>aavoid_freshss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"alpha_aavoids"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_aavoids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_nchotomys"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_nchotomys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_cases"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TT_fresh_cases</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_existential_co_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TT_existential_co_induct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_co_induct_param"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TT_fresh_co_induct_param</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_co_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TT_fresh_co_induct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_plain_co_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>TT_plain_co_induct</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_id0s"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_id0s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_ids"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_bijs"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_bijs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_inv_simps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_inv_simps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_comps"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_comps</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_comp0s"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_comp0s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rrename_cong_ids"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rrename_cong_ids</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
       </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"cctor_eq_intro_rrenames"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cctor_eq_intro_rrenames</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="inner_quoted"><span>"TT_fresh_induct_param_no_clash"</span></span><span> </span><span>o</span><span> </span><span>single</span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>TT_fresh_induct_param_no_clash_opt</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="inner_quoted"><span>"TT_subshape_induct"</span></span><span> </span><span>o</span><span> </span><span>single</span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>TT_subshape_induct_opt</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="inner_quoted"><span>"wf_subshape"</span></span><span> </span><span>o</span><span> </span><span>single</span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>wf_subshape_opt</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="inner_quoted"><span>"set_subshape_images"</span></span><span> </span><span>o</span><span> </span><span>flat</span><span> </span><span>o</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>set_subshape_imagesss_opt</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>  </span><span>@</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>pair</span><span> </span><span class="inner_quoted"><span>"set_subshapes"</span></span><span> </span><span>o</span><span> </span><span>flat</span><span> </span><span>o</span><span> </span><span>flat</span><span class="main"><span>)</span></span><span>
        </span><span class="entity"><span>set_subshapesss_opt</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>names</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>noted</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
    </span><span class="main"><span>(</span></span><span class="entity"><span>res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
</span></pre>
</body>

</html>