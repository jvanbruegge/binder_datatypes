<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹~/repos/bnfs/binder_datatypes/Tools/mrbnf_fp_def_sugar.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹~/repos/bnfs/binder_datatypes/Tools/mrbnf_fp_def_sugar.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>MRBNF_FP_DEF_SUGAR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>fp_result_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    T</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
    ctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    permute</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    FVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    noclash</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
    inner</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>

    inject</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_ctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_id0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_id</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_comp0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_comp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    FVars_ctors</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    FVars_permutes</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    FVars_intross</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    card_of_FVars_bounds</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    card_of_FVars_bound_UNIVs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    alpha</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    exhaust</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>

    alpha_refl</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_sym</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_trans</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_bij</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_bij_eq</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_bij_eq_inv</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_FVarss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    alpha_intro</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    alpha_elim</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    abs</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    rep</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>

    ctor_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    FVars_defs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>

    fresh_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    noclash_permute</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    nnoclash_noclash</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    total_abs_eq_iff</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    abs_rep</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    rep_abs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    rep_abs_sym</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    abs_ctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>

    permute_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_cong_id</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_bij</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    permute_inv_simp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>least_fp_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    subshape_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    subshapess</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    wf_subshape</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    set_subshapess</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    set_subshape_permutess</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    subshape_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    existential_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    fresh_induct_param</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    fresh_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    fp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span class="main"><span>,</span></span><span>
    binding_relation</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    rec_vars</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    bfree_vars</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    raw_fps</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    quotient_fps</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    fp_thms</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>least_fp_thms</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
    pre_mrbnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_Def.mrbnf</span></span><span> </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> substitute_vars</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_result</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_result_T</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="main"><span>-&gt;</span></span><span> 'a</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="entity"><span>fp_result_T</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span class="entity"><span>fp_result_T</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_raw_result</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>raw_result</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_quotient_result</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> morph_fp_result</span><span class="main"><span>:</span></span><span> </span><span>morphism</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_result</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> fp_result_of</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span>option</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> register_fp_results</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> note_fp_result</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP_DEF_SUGAR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>fp_result_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  T</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
  ctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  permute</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  FVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  noclash</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> * </span><span>thm</span><span class="main"><span>,</span></span><span>
  inner</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>

  inject</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_ctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_id0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_id</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_comp0</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_comp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  FVars_ctors</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  FVars_permutes</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  FVars_intross</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  card_of_FVars_bounds</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  card_of_FVars_bound_UNIVs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_result_T</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>noclash</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inner</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inject</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_ctor</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>permute_id0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_id</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_comp0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_comp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_ctors</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_permutes</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>card_of_FVars_bounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>card_of_FVars_bound_UNIVs</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  T </span><span class="main"><span>=</span></span><span> </span><span>Morphism.typ</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span>
  ctor </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>,</span></span><span>
  permute </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute</span></span><span class="main"><span>,</span></span><span>
  FVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVarss</span></span><span class="main"><span>,</span></span><span>
  noclash </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>BNF_Util.map_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>noclash</span></span><span class="main"><span>,</span></span><span>
  inner </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>inner</span></span><span class="main"><span>,</span></span><span>
  inject </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>inject</span></span><span class="main"><span>,</span></span><span>
  permute_ctor </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_ctor</span></span><span class="main"><span>,</span></span><span>
  permute_id0 </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_id0</span></span><span class="main"><span>,</span></span><span>
  permute_id </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_id</span></span><span class="main"><span>,</span></span><span>
  permute_comp0 </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_comp0</span></span><span class="main"><span>,</span></span><span>
  permute_comp </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_comp</span></span><span class="main"><span>,</span></span><span>
  FVars_ctors </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_ctors</span></span><span class="main"><span>,</span></span><span>
  FVars_permutes </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_permutes</span></span><span class="main"><span>,</span></span><span>
  FVars_intross </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_intross</span></span><span class="main"><span>,</span></span><span>
  card_of_FVars_bounds </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>card_of_FVars_bounds</span></span><span class="main"><span>,</span></span><span>
  card_of_FVars_bound_UNIVs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>card_of_FVars_bound_UNIVs</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> 'a </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  alpha</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  exhaust</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>

  alpha_refl</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_sym</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_trans</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_bij</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_bij_eq</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_bij_eq_inv</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_FVarss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  alpha_intro</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  alpha_elim</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_raw_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>alpha</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>alpha_bij_eq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_bij_eq_inv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_FVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  alpha </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha</span></span><span class="main"><span>,</span></span><span>
  exhaust </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>exhaust</span></span><span class="main"><span>,</span></span><span>
  alpha_refl </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_refl</span></span><span class="main"><span>,</span></span><span>
  alpha_sym </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_sym</span></span><span class="main"><span>,</span></span><span>
  alpha_trans </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_trans</span></span><span class="main"><span>,</span></span><span>
  alpha_bij </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_bij</span></span><span class="main"><span>,</span></span><span>
  alpha_bij_eq </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_bij_eq</span></span><span class="main"><span>,</span></span><span>
  alpha_bij_eq_inv </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_bij_eq_inv</span></span><span class="main"><span>,</span></span><span>
  alpha_FVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_FVarss</span></span><span class="main"><span>,</span></span><span>
  alpha_intro </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_intro</span></span><span class="main"><span>,</span></span><span>
  alpha_elim </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>alpha_elim</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>raw_result</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  abs</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  rep</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>

  ctor_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_def</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  FVars_defs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>

  fresh_cases</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  nnoclash_noclash</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  noclash_permute</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  total_abs_eq_iff</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  abs_rep</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  rep_abs</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  rep_abs_sym</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  abs_ctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>

  permute_cong</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_cong_id</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_bij</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  permute_inv_simp</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_quotient_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_def</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_defs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>nnoclash_noclash</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>total_abs_eq_iff</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs_rep</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_abs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rep_abs_sym</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>abs_ctor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_cong</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_cong_id</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>permute_bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>permute_inv_simp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>noclash_permute</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh_cases</span></span><span> </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  abs </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>abs</span></span><span class="main"><span>,</span></span><span>
  rep </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rep</span></span><span class="main"><span>,</span></span><span>
  ctor_def </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctor_def</span></span><span class="main"><span>,</span></span><span>
  permute_def </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_def</span></span><span class="main"><span>,</span></span><span>
  FVars_defs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_defs</span></span><span class="main"><span>,</span></span><span>
  fresh_cases </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fresh_cases</span></span><span class="main"><span>,</span></span><span>
  noclash_permute </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>noclash_permute</span></span><span class="main"><span>,</span></span><span>
  nnoclash_noclash </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>nnoclash_noclash</span></span><span class="main"><span>,</span></span><span>
  total_abs_eq_iff </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>total_abs_eq_iff</span></span><span class="main"><span>,</span></span><span>
  abs_rep </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>abs_rep</span></span><span class="main"><span>,</span></span><span>
  rep_abs </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rep_abs</span></span><span class="main"><span>,</span></span><span>
  rep_abs_sym </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>rep_abs_sym</span></span><span class="main"><span>,</span></span><span>
  abs_ctor </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>abs_ctor</span></span><span class="main"><span>,</span></span><span>
  permute_cong </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_cong</span></span><span class="main"><span>,</span></span><span>
  permute_cong_id </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_cong_id</span></span><span class="main"><span>,</span></span><span>
  permute_bij </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_bij</span></span><span class="main"><span>,</span></span><span>
  permute_inv_simp </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>permute_inv_simp</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>least_fp_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  subshape_rel</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  subshapess</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  wf_subshape</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  set_subshapess</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  set_subshape_permutess</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  subshape_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  existential_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  fresh_induct_param</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  fresh_induct</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_least_fp_thms</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>subshape_rel</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshapess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>wf_subshape</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>set_subshapess</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>set_subshape_permutess</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>subshape_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>existential_induct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh_induct_param</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fresh_induct</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  subshape_rel </span><span class="main"><span>=</span></span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>subshape_rel</span></span><span class="main"><span>,</span></span><span>
  subshapess </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshapess</span></span><span class="main"><span>,</span></span><span>
  wf_subshape </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>wf_subshape</span></span><span class="main"><span>,</span></span><span>
  set_subshapess </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_subshapess</span></span><span class="main"><span>,</span></span><span>
  set_subshape_permutess </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>set_subshape_permutess</span></span><span class="main"><span>,</span></span><span>
  subshape_induct </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>subshape_induct</span></span><span class="main"><span>,</span></span><span>
  existential_induct </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>existential_induct</span></span><span class="main"><span>,</span></span><span>
  fresh_induct_param </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fresh_induct_param</span></span><span class="main"><span>,</span></span><span>
  fresh_induct </span><span class="main"><span>=</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fresh_induct</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>least_fp_thms</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  fp</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BNF_Util.fp_kind</span></span><span class="main"><span>,</span></span><span>
  binding_relation</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span> </span><span>list</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  rec_vars</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  bfree_vars</span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  raw_fps</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>raw_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  quotient_fps</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  fp_thms</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>least_fp_thms</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  pre_mrbnfs</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_Def.mrbnf</span></span><span> </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph_fp_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bfree_vars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>raw_fps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quotient_fps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_mrbnfs</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  fp </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> binding_relation </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>binding_relation</span></span><span class="main"><span>,</span></span><span> rec_vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rec_vars</span></span><span class="main"><span>,</span></span><span> bfree_vars </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bfree_vars</span></span><span class="main"><span>,</span></span><span>
  raw_fps </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_fp_result_T</span></span><span> </span><span class="entity"><span>morph_raw_result</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>raw_fps</span></span><span class="main"><span>,</span></span><span>
  quotient_fps </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_fp_result_T</span></span><span> </span><span class="entity"><span>morph_quotient_result</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quotient_fps</span></span><span class="main"><span>,</span></span><span>
  fp_thms </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_least_fp_thms</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>,</span></span><span>
  pre_mrbnfs </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.morph_mrbnf</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pre_mrbnfs</span></span><span>
</span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>substitute_vars</span></span><span> </span><span class="entity"><span>replacements</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Morphism.morphism</span><span> </span><span class="inner_quoted"><span>"instantiate vars"</span></span><span> </span><span class="main"><span>{</span></span><span>
      binding </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> fact </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      typ </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.typ_subst_atomic</span><span> </span><span class="entity"><span>replacements</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      term </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.subst_atomic_types</span><span> </span><span class="entity"><span>replacements</span></span><span class="main"><span>]</span></span><span>
    </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>morph_fp_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Data</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Generic_Data</span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span>Symtab.table</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>empty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.empty</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>merge</span></span><span> </span><span class="entity"><span>data</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Symtab.merge</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>data</span></span><span class="main"><span>;</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>register_fp_results</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_result</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="entity"><span>quotient_fps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span> T </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax </span><span class="main"><span>=</span></span><span> </span><span>false</span><span class="main"><span>,</span></span><span> pervasive </span><span class="main"><span>=</span></span><span> </span><span>true</span><span class="main"><span>,</span></span><span> pos </span><span class="main"><span>=</span></span><span> </span><span>Position.none</span><span class="main"><span>}</span></span><span>
    </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Data.map</span><span> </span><span class="main"><span>(</span></span><span>Symtab.update</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morph_fp_result</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>fp_result</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quotient_fps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>fp_result_of_generic</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph_fp_result</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.transfer_morphism</span><span> </span><span class="main"><span>(</span></span><span>Context.theory_of</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span>o</span><span> </span><span>Symtab.lookup</span><span> </span><span class="main"><span>(</span></span><span>Data.get</span><span> </span><span class="entity"><span>context</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_result_of</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fp_result_of_generic</span></span><span> </span><span>o</span><span> </span><span>Context.Proof</span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_fp_result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>fp_result</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_internals</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_ctor"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_ctor </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_ctor"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_intros"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_bd"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>card_of_FVars_bounds </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_bd_UNIVs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>card_of_FVars_bound_UNIVs </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"nnoclash_noclash"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>nnoclash_noclash </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"total_abs_eq_iff"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>total_abs_eq_iff </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_cases"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>fresh_cases </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"abs_rep"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_rep </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rep_abs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"rep_abs_sym"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rep_abs_sym </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"abs_ctor"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_ctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_inject0"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>inject </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_always</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"noclash_permute"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>noclash_permute </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_id0"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_id0 </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_id"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_id </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_comp0"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_comp0 </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_comp"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>quot</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"FVars_permute"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_cong"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_cong </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_cong_id"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_cong_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_bij"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_bij </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"permute_inv_simp"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_inv_simp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>note_quot</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quotient_result</span></span><span> </span><span class="entity"><span>fp_result_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Config.get</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>MRBNF_Def.mrbnf_internals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
        </span><span class="entity"><span>note_internals</span></span><span> </span><span class="entity"><span>quot</span></span><span>
        </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"wf_subshape"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>wf_subshape </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"set_subshapes"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"set_subshape_permutes"</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"subshape_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>subshape_induct </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"existential_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>existential_induct </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"fresh_induct_param"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>fresh_induct_param </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"TT_fresh_induct"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>fresh_induct </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span>@</span><span> </span><span class="entity"><span>note_always</span></span><span> </span><span class="entity"><span>quot</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thmN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.qualify</span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Util.short_type_name</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="entity"><span>thmN</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>note_quot</span></span><span> </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.notes</span><span> </span><span class="entity"><span>notes</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span></pre>
</body>

</html>