<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹Tools/mrbnf_recursor.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹Tools/mrbnf_recursor.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>MRBNF_RECURSOR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>parameter_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    Pmap_id0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    Pmap_comp0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    Pmap_cong_id</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    PFVars_Pmaps</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span class="main"><span>,</span></span><span>
    small_PFVarss</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span class="main"><span>,</span></span><span>
    small_avoiding_sets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>parameter</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    P</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
    PFVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    Pmap</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    avoiding_sets</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
      pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
      valid_Pmap</span><span class="main"><span>:</span></span><span> 'a
    </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
    axioms</span><span class="main"><span>:</span></span><span> 'a </span><span class="entity"><span>parameter_axioms</span></span><span class="main"><span>,</span></span><span>
    min_bound</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>model_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    Umap_id0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    Umap_comp0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    Umap_cong_id</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    Umap_Uctor</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    UFVars_subsets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    binding</span><span class="main"><span>:</span></span><span> </span><span>binding</span><span class="main"><span>,</span></span><span>
    U</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
    UFVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
    Umap</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    Uctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
      pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
      valid_Umap</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
      valid_Uctor</span><span class="main"><span>:</span></span><span> 'a
    </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
    axioms</span><span class="main"><span>:</span></span><span> 'a </span><span class="entity"><span>model_axioms</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>quotient_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    binding</span><span class="main"><span>:</span></span><span> </span><span>binding</span><span class="main"><span>,</span></span><span>
    Uctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
      pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
      valid_permute</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
      valid_Uctor</span><span class="main"><span>:</span></span><span> 'a
    </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
    axioms</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
      permute_Uctor</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
      FVars_subsets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>recursor_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
    rec_fun</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    rec_Uctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    rec_swap</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
    rec_valid</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
    rec_UFVarss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_def_t</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bstring</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> * </span><span>local_theory</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_defs_t</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bstring</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>int</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>term</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span>local_theory</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> chop_f_prems</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span> </span><span>list</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> every_other</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a </span><span>list</span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_supp_bound</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span class="main"><span>;</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_quotient_model</span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.quotient_result</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result_T</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>typ</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quotient_model</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> create_binding_recursor</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>binding</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result</span></span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>parameter</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span>list</span><span>
    </span><span class="main"><span>-&gt;</span></span><span> </span><span>local_theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>recursor_result</span></span><span> </span><span>list</span><span> * </span><span>local_theory</span><span class="main"><span>;</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>MRBNF_Recursor</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_RECURSOR</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Util</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Def</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>MRBNF_Recursor_Tactics</span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>BNF_Tactics</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>parameter_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  Pmap_id0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  Pmap_comp0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  Pmap_cong_id</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  PFVars_Pmaps</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span class="main"><span>,</span></span><span>
  small_PFVarss</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span class="main"><span>,</span></span><span>
  small_avoiding_sets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>parameter</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  P</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
  PFVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  Pmap</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  avoiding_sets</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
    pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    valid_Pmap</span><span class="main"><span>:</span></span><span> 'a
  </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  axioms</span><span class="main"><span>:</span></span><span> 'a </span><span class="entity"><span>parameter_axioms</span></span><span class="main"><span>,</span></span><span>
  min_bound</span><span class="main"><span>:</span></span><span> </span><span>bool</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>model_axioms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  Umap_id0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  Umap_comp0</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  Umap_cong_id</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  Umap_Uctor</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
  UFVars_subsets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  binding</span><span class="main"><span>:</span></span><span> </span><span>binding</span><span class="main"><span>,</span></span><span>
  U</span><span class="main"><span>:</span></span><span> </span><span>typ</span><span class="main"><span>,</span></span><span>
  UFVarss</span><span class="main"><span>:</span></span><span> </span><span>term</span><span> </span><span>list</span><span class="main"><span>,</span></span><span>
  Umap</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  Uctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
    pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    valid_Umap</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    valid_Uctor</span><span class="main"><span>:</span></span><span> 'a
  </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  axioms</span><span class="main"><span>:</span></span><span> 'a </span><span class="entity"><span>model_axioms</span></span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> 'a </span><span class="entity"><span>quotient_model</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  binding</span><span class="main"><span>:</span></span><span> </span><span>binding</span><span class="main"><span>,</span></span><span>
  Uctor</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  validity</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
    pred</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
    valid_permute</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    valid_Uctor</span><span class="main"><span>:</span></span><span> 'a
  </span><span class="main"><span>}</span></span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  axioms</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>{</span></span><span>
    permute_Uctor</span><span class="main"><span>:</span></span><span> 'a</span><span class="main"><span>,</span></span><span>
    FVars_subsets</span><span class="main"><span>:</span></span><span> 'a </span><span>list</span><span>
  </span><span class="main"><span>}</span></span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>recursor_result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
  rec_fun</span><span class="main"><span>:</span></span><span> </span><span>term</span><span class="main"><span>,</span></span><span>
  rec_Uctor</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  rec_swap</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span class="main"><span>,</span></span><span>
  rec_valid</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>option</span><span class="main"><span>,</span></span><span>
  rec_UFVarss</span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span>
</span><span class="main"><span>}</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_supp_bound</span></span><span> </span><span class="entity"><span>h</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_supp</span></span><span> </span><span class="entity"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>h</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bij</span></span><span>::</span><span class="entity"><span>supp</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>supp</span></span><span class="main"><span>]</span></span><span>::</span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_cmin</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_supp_bound'</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_supp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>bd</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
      </span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_bij</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_supp_bound'</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="entity"><span>hs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="entity"><span>hs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="entity"><span>pred_opt</span></span><span> </span><span class="entity"><span>d</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pred_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
  </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
    </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    </span><span class="entity"><span>p</span></span><span>
  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>card_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.supp_id_bound_cmin|fact"><span>supp_id_bound_cmin</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLess_ordLeq_trans|fact"><span>ordLess_ordLeq_trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin|const"><span class="const"><span>cmin</span></span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of|const"><span>|</span></a></span><span class="main"><span>_</span></span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of|const"><span>|</span></a></span><span>"</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin1|fact"><span>cmin1</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin2|fact"><span>cmin2</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_quotient_model</span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="entity"><span>substitution</span></span><span> </span><span class="entity"><span>codomain_substitution</span></span><span> </span><span class="entity"><span>qmodel</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subst</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>substitution</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>substitution</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_cosubst</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>null</span><span> </span><span class="entity"><span>codomain_substitution</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>I</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>codomain_substitution</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subst</span></span><span> </span><span>Term.subst_atomic_types</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subst</span></span><span> </span><span>Term.typ_subst_atomic</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cosubst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_cosubst</span></span><span> </span><span>Term.subst_atomic_types</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cosubstT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_cosubst</span></span><span> </span><span>Term.typ_subst_atomic</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>split_last</span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>{</span></span><span>
    U </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cosubstT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>substT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    binding </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>qmodel</span></span><span class="main"><span>,</span></span><span>
    UFVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>cosubst</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>subst</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    Umap </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>cosubstT</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>substT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>substT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cosubst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span>Bound</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>downto</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    Uctor </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>qmodel</span></span><span class="main"><span>,</span></span><span>
    validity </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>
      pred </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span>
      valid_Umap </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>valid_permute </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span>
      valid_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>valid_Uctor </span><span class="entity"><span>v</span></span><span>
    </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>qmodel</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    axioms </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
      Umap_id0 </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute_id </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
      Umap_comp0 </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      Umap_cong_id </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute_cong_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
      Umap_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>permute_Uctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>qmodel</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      UFVars_subsets </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>FVars_subsets </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>qmodel</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span>
  </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_termlike_goals</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quotient_opt</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.quotient_result</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result_T</span></span><span> </span><span>option</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="entity"><span>pred_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"d"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>]</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t"</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>T</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quotient_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"a"</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="entity"><span>pred_opt</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>{</span></span><span>
    map_id0 </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>d</span></span><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    map_comp0 </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
    map_cong_id </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.implies</span><span> </span><span>$</span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span>::</span><span class="entity"><span>t</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>,</span></span><span>
    FVars_map </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>d</span></span><span>::</span><span class="entity"><span>t</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="entity"><span>min_bound</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>quotient_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>mk_image</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>}</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span class="const"><span>True</span></span></a></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>;</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>QT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>Q</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>PT</span></span><span> </span><span>--&gt;</span><span> </span><span>domain_type</span><span> </span><span class="entity"><span>QT</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Basic_BNFs.html#Basic_BNFs.pred_fun|const"><span class="const"><span>pred_fun</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>QT</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>fT</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UPred</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>valids</span></span><span> </span><span class="entity"><span>rec_vars</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>exists</span><span> </span><span>Option.isSome</span><span> </span><span class="entity"><span>valids</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
        </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>MRBNF_Def.mk_pred_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span>
        </span><span>map</span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="entity"><span>validP</span></span><span> </span><span class="entity"><span>t</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="entity"><span>rec_vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valids</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>pre_pred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove_model_axioms</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pfrees</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pbounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ptacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.conglomerate</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs_hidden</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.suffix_name</span><span> </span><span class="inner_quoted"><span>"_rec"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>qualify</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def_hidden</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_def_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.suffix_name</span><span> </span><span class="inner_quoted"><span>"_rec"</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>qualify</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span class="entity"><span>context</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Ctr_Sugar_Tactics.unfold_thms_tac</span></span><span> </span><span class="entity"><span>context</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span>THEN</span><span> </span><span class="entity"><span>tac</span></span><span> </span><span class="entity"><span>context</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>def_option</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t_opt</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>t_opt</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apfst</span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>def_hidden</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PFVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>PFVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>defs_hidden</span></span><span> </span><span class="inner_quoted"><span>"PFVars"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def_hidden</span></span><span> </span><span class="inner_quoted"><span>"Pmap"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>defs_hidden</span></span><span> </span><span class="inner_quoted"><span>"avoiding_set"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def_option</span></span><span> </span><span class="inner_quoted"><span>"validP"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>avoiding_sets</span></span><span class="main"><span>,</span></span><span> </span><span>Option.map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>PFVarss</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>avoiding_sets</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pgoals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_termlike_goals</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>--&gt;</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>card</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>foldl1</span><span> </span><span class="entity"><span>mk_cmin</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>small_PFVars_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>FVars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Logic.all</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>small_avoiding_set_goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_ordLess</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>avoiding_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Pmap </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>param_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
      Pmap_id0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>pgoals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap_id0 </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      Pmap_comp0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_comp0 </span><span class="entity"><span>pgoals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap_comp0 </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      Pmap_cong_id </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong_id </span><span class="entity"><span>pgoals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap_cong_id </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      PFVars_Pmaps </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_map </span><span class="entity"><span>pgoals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVars_Pmaps </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      small_PFVarss </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>small_PFVars_goals</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>small_PFVarss </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      small_avoiding_sets </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>small_avoiding_set_goals</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>small_avoiding_sets </span><span class="entity"><span>ptacs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="entity"><span>parameter_axioms</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
      P </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span>
      PFVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>,</span></span><span>
      Pmap </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span>
      avoiding_sets </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>avoiding_sets</span></span><span class="main"><span>,</span></span><span>
      validity </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>
        pred </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>def</span></span><span class="main"><span>,</span></span><span>
        valid_Pmap </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span>
      </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>validP_opt</span></span><span class="main"><span>,</span></span><span>
      axioms </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>param_thms</span></span><span class="main"><span>,</span></span><span>
      min_bound </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span>
    </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="entity"><span>parameter</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>models</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_defss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span>split_list</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>qual</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"_"</span></span><span> </span><span>^</span><span> </span><span>Binding.name_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>UFVarss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Umap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Uctor</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>validU_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>defs_hidden</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qual</span></span><span> </span><span class="inner_quoted"><span>"UFVars"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span>
            </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def_hidden</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qual</span></span><span> </span><span class="inner_quoted"><span>"Umap"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span>
            </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def_hidden</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qual</span></span><span> </span><span class="inner_quoted"><span>"Uctor"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span>
            </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def_option</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>qual</span></span><span> </span><span class="inner_quoted"><span>"validU"</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UFVarss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>UFVarss</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Umap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>Umap</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Uctor</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>Uctor</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validU_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>validU_opt</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span>
          binding </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          U </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          UFVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>UFVarss</span></span><span class="main"><span>,</span></span><span>
          Umap </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>Umap</span></span><span class="main"><span>,</span></span><span>
          Uctor </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>Uctor</span></span><span class="main"><span>,</span></span><span>
          validity </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>
            pred </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>validU_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            valid_Umap </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>valid_Umap </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span>
            valid_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>valid_Uctor </span><span class="entity"><span>v</span></span><span>
          </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          axioms </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>tactic</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>UFVarss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>Umap</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>Uctor</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>validU_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>model_defss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>models'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quotient_fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.live_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>free</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.free_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.deads_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prod_PUs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quotient_fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quotient_fp</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prod_PUs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pus</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.mk_T_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"pu"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.dest_prodT</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"u"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>]</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quotient_fp</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tacs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_termlike_goals</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>quotient_fp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapF_ap</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>As'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>replicate</span><span> </span><span class="entity"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapF</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.mk_map_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As'</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>BNF_Util.fst_const</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.interlace</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fsts</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapF</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addUPred</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>mk_UPred</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Umap_Uctor_goal</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>quotient_fp</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapF_ap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_GFP_Util.mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pair_maps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>quot</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pus</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapF</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>MRBNF_Def.mk_map_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>MRBNF_Def.interlace</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pair_maps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bfree_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addUPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctor_map</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapF</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UFVars_subset_goals</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>count</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>live</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>free</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>bound</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf_sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
              </span><span>~~</span><span>
              </span><span class="entity"><span>MRBNF_Def.mk_sets_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>count</span></span><span> </span><span class="entity"><span>deads</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>count</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>count</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>count</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>topBind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.Bound_Var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_sets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>avoiding_sets</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recSetss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.Live_Var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf_sets</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recSets_Uns</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>mk_Un</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recSetss</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addUPred</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="entity"><span>mk_Int</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>topBind</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Lattices.html#Lattices.sup_class.sup|const"><span class="const"><span>sup</span></span></a><span class="antiquote"><span>}</span></span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Orderings.html#Orderings.bot_class.bot|const"><span class="const"><span>bot</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_setT</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map_filter</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>prod_PU</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quotient_fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>recSets_Un</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>prod_PU</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu_T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t_T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.implies</span><span> </span><span>$</span><span>
                      </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_tuple</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>recSets_Un</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span>
                      </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span>
                        </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>quotient_fp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prod_PUs</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>recSets_Uns</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span>
                  </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>quotient_fp</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapF_ap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>quotient_fp</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>quotient_fp</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapF_ap</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>PFVarss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
            </span><span>map</span><span> </span><span class="entity"><span>mk_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>model_thms</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
          Umap_id0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_id0 </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_id0 </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          Umap_comp0 </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_comp0 </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_comp0 </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          Umap_cong_id </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>map_cong_id </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_cong_id </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          Umap_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>Umap_Uctor_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_Uctor </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          UFVars_subsets </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>UFVars_subset_goals</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVars_subsets </span><span class="entity"><span>tacs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="entity"><span>model_axioms</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Umap_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>add_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>u</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Uctor_goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addUPred</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>{</span></span><span>
            pred </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span>
            valid_Umap </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>valid_Umap_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Umap </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            valid_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span> </span><span class="entity"><span>valid_Uctor_goal</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Uctor </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>}</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>model'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span>
          binding </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          U </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          UFVarss </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          Umap </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          Uctor </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span>
          validity </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>validity</span></span><span class="main"><span>,</span></span><span>
          axioms </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>model_thms</span></span><span>
        </span><span class="main"><span>}</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="entity"><span>model</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>model'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>models'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_binop</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span class="const"><span>minus</span></span></a><span class="antiquote"><span>}</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_bin_map</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>g</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fb</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="entity"><span>f_T</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ga</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gb</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>dest_funT</span><span> </span><span class="entity"><span>g_T</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>g_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fa</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ga</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fb</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gb</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_map_prod</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bin_map</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.map_prod|const"><span class="const"><span>map_prod</span></span></a><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_map_sum</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_bin_map</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Sum_Type.html#Sum_Type.map_sum|const"><span class="const"><span>map_sum</span></span></a><span class="antiquote"><span>}</span></span></span><span> </span><span class="entity"><span>BNF_Util.mk_sumT</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inv_image</span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="entity"><span>f_T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.inv_image|const"><span class="const"><span>inv_image</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span>
    </span><span>fastype_of</span><span> </span><span class="entity"><span>R</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>f_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>BNF_Util.mk_relT</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arg_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>arg_T</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>R</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_names</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_names</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>s</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_names</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span>string_of_int</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>define_recursor_consts</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.fp_result</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span class="entity"><span>model</span></span><span> </span><span>list</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pfrees</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pbounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>card</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>foldl1</span><span> </span><span class="entity"><span>mk_cmin</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_UNIV</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_supp_bound</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_ordLess</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_card_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_supp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>card</span></span><span> </span><span class="main"><span>(</span></span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Theory.begin_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitabless</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.sets_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_T</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.Bound_Var</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pick"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>f_T</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Un_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>avoiding_set</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>
              </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_imp</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>mk_bij</span></span><span> </span><span class="entity"><span>pick_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_supp_bound</span></span><span> </span><span class="entity"><span>pick_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>pick_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Un_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Un_t</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>rhss</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_names</span></span><span> </span><span class="inner_quoted"><span>"suitable"</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitables</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"pick"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctor</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_def_t</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qualify</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>abs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_PUmap</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="entity"><span>Umap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Umap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span>
              </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X'_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>split_last</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.strip_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A'_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>Term.binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span class="tconst"><span>prod</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PU</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span>
                </span><span>List.find</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>T </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span> </span><span>~~</span><span> </span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PU</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>A'_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>X_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>X'_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>A_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>A'_T</span></span><span class="main"><span>)</span></span><span>
              </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span class="tconst"><span>prod</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PU</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="main"><span>#</span></span><span>abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span>List.find</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>T</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>PU</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>T</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="entity"><span>A'_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>Umap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UFVars's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PUmap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Uctor'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_quoted"><span>"Umap'"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>abs</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="inner_quoted"><span>"UFVars'"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UFVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abs</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_quoted"><span>"PUmap"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_PUmap</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_quoted"><span>"Uctor'"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mapx</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>def</span></span><span> </span><span class="inner_quoted"><span>"PUmap'"</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_PUmap</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span> Umap' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>,</span></span><span> UFVars's </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>UFVars's</span></span><span class="main"><span>,</span></span><span> PUmap </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>PUmap</span></span><span class="main"><span>,</span></span><span> PUmap' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> Uctor' </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>}</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Binding.conglomerate</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>interlace</span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>bfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.interlace</span></span><span>
      </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>frees</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model_const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mapx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X'_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>split_last</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.strip_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>X'_T</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>pre_T</span></span><span> </span><span>--&gt;</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>Term.binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor' </span><span class="entity"><span>model_const</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>X'_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>pre_T</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv1</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>,</span></span><span> </span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv2</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mapx</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_GFP_Util.mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rec_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"f_"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>short_type_name</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.name_of</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>names_lthy</span></span><span>
          </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="entity"><span>f_name</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>--&gt;</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>var_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
            </span><span class="comment1"><span>(* TODO: Fix for multiple bounds *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>to_rename</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>is</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>is</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>forall</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id|const"><span class="const"><span>id</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>to_rename</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>to_rename</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>interlace</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_types</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t2</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>interlace</span></span><span> </span><span class="entity"><span>rename_ts</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_types</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>map_ts</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model_const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>$</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitables</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>validP</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor' </span><span class="entity"><span>model_const</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.undefined|const"><span class="const"><span>undefined</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>model_consts</span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="entity"><span>map_ts</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Function.add_function</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span class="main"><span>(</span></span><span>Binding.name</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NoSyn</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Binding.concealed</span><span> </span><span>Binding.empty</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>Function_Common.default_config</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_f_pat_complete_tac</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>inject </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_relation</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_relT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>swap</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>BNF_FP_Util.dest_sumT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>::</span><span> </span><span>rev</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sndss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>split_list</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>funs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>snds</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span>::</span><span> </span><span>rev</span><span> </span><span class="entity"><span>snds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sndss</span></span><span> </span><span class="entity"><span>Ts'</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_sum</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span>uncurry</span><span> </span><span class="entity"><span>mk_map_sum</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>funs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_inv_image</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>subshape_rel </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_sum</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mp'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
              </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>conj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mp'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>spec</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>spec</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>iffD1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.meta_eq_to_obj_eq|fact"><span>meta_eq_to_obj_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>suitable_def</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conj</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conj</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitables</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>info</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Function.prove_termination</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>Function_Common.termination_prover_tac</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_f_termination_tac</span></span><span> </span><span class="entity"><span>mk_relation</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>wf_subshape </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="entity"><span>set_map_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_simps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lhs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model_const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apsnd</span><span> </span><span>split_last</span><span> </span><span class="main"><span>(</span></span><span>Term.strip_comb</span><span> </span><span class="entity"><span>map_t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>split_last</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>Term.strip_comb</span><span> </span><span class="entity"><span>map_t2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id|const"><span class="const"><span>id</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>
              </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id|const"><span class="const"><span>id</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args1</span></span><span> </span><span class="entity"><span>args2</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_t'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>

           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitables</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>
             </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lhs</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor' </span><span class="entity"><span>model_const</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>picks</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>simps </span><span class="entity"><span>info</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>ORELSE'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lhss</span></span><span> </span><span class="entity"><span>map_ts</span></span><span> </span><span class="entity"><span>model_consts</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fs </span><span class="entity"><span>info</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>f_simps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick0ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>fold_map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.Eps|const"><span class="const"><span>Eps</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>typ</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.bool|type"><span class="tconst"><span>bool</span></span></a></span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_names</span></span><span> </span><span class="inner_quoted"><span>"pick0"</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f0s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="inner_quoted"><span>"f0"</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick0ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ff0s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="inner_quoted"><span>"ff0"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>suitables</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Pmap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="inner_quoted"><span>"XXl"</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_ts'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model_const</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>f</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_ts'</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inner_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>binds</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
                  </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="main"><span>(</span></span><span>Term.body_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>pick_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PU_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PUmap' </span><span class="entity"><span>model_const</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span class="entity"><span>inner_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_t</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>inner_t</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="entity"><span>PU_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>interlace</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>pick_ts'</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick_ts'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_ts</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXrs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_defs_t</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="inner_quoted"><span>"XXr"</span></span><span> </span><span class="entity"><span>n</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>map_t2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>var_types</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inner_map</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>interlace</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rename_ts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="entity"><span>var_types</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>inner_map</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>f</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_t</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rename_t</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>interlace</span></span><span> </span><span class="entity"><span>recs</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>var_types</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_ts</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lthy</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>old_lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>`</span><span>Local_Theory.end_nested</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.export_morphism</span><span> </span><span class="entity"><span>old_lthy</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor' </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor' </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>Morphism.term</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>Umap'</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>UFVars's</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span>
    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>PUmap'</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>PUmap</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>morph</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>Uctor'</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>model_consts</span></span><span class="main"><span>,</span></span><span>
    </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick0ss</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>f0s</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>ff0s</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>morph</span></span><span> </span><span class="entity"><span>XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
  </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>every_other</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>every_other</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>every_other</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span>::</span><span class="main"><span>_</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span>::</span><span class="entity"><span>every_other</span></span><span> </span><span class="entity"><span>xs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>every_other'</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>every_other'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span>::</span><span class="main"><span>_</span></span><span>::</span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>every_other'</span></span><span> </span><span class="entity"><span>xs</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>create_binding_recursor</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>Ts</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>-</span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>Term.binder_types</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>passives</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pfrees</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pbounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>type_name</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span class="tconst"><span>prod</span></span></a><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>dest_Type</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span>Term.binder_types</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor_T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>replacement</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sort</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Vartab.dest</span><span> </span><span class="entity"><span>tyenv</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_FP_Def_Sugar.substitute_vars</span></span><span> </span><span class="entity"><span>replacement</span></span><span> </span><span class="entity"><span>fp_res</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Term.dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.T_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor_T</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Envir.subst_type</span><span> </span><span class="entity"><span>tyenv</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_passives</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>subtract</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_passives</span></span><span> </span><span class="entity"><span>MRBNF_Def.frees_of_mrbnf</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>get_passives</span></span><span> </span><span class="entity"><span>MRBNF_Def.bounds_of_mrbnf</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>map</span><span> </span><span class="entity"><span>subst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.lives_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fp_res</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pfrees</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pbounds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prove_model_axioms</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>passives</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>suitabless</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Umap's</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PUmaps</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick0ss</span></span><span class="main"><span>,</span></span><span>
      </span><span class="entity"><span>f0s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ff0s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>define_recursor_consts</span></span><span> </span><span class="entity"><span>qualify</span></span><span> </span><span class="entity"><span>fp_res</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="entity"><span>passives</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_Tss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pus</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
      </span><span>|&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"f"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"g"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"pick"</span></span><span> </span><span class="entity"><span>pick_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Freess</span></span><span> </span><span class="inner_quoted"><span>"pick'"</span></span><span> </span><span class="entity"><span>pick_Tss</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctor</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"x'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>ctor</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"y'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"v"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>Uctor</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"v'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>Uctor</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"t'"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"pu"</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"p"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span>
      </span><span>||&gt;&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span class="entity"><span>mk_Frees</span></span><span> </span><span class="inner_quoted"><span>"p'"</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pfrees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_pre_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.sets_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tyenv</span></span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sets</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.Live_Var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span>::</span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.Bound_Var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span>::</span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.Free_Var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span>::</span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sets</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span>#&gt;</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>filter</span><span> </span><span class="main"><span>(</span></span><span>not</span><span> </span><span>o</span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.dest_setT</span></span><span> </span><span>o</span><span> </span><span>snd</span><span> </span><span>o</span><span> </span><span>dest_funT</span><span> </span><span>o</span><span> </span><span>fastype_of</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pbounds</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pre_setss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_pre_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pre_setss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>ctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PU_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pre_setss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span> </span><span class="entity"><span>Uctor's</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_PU_setss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pre_setss</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_idxss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pre_setss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_UNss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lsets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>idxs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVarss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fsets</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>j</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UN</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UN</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>UN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsets</span></span><span> </span><span class="entity"><span>idxs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>FVarss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pre_setss</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>rec_idxss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span>o</span><span> </span><span>dest_Free</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_id_onss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_Diff|fact"><span>Un_Diff</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Diff_idemp|fact"><span>Diff_idemp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_Un|fact"><span>id_on_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_UNss</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_id_onsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_id_on</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_Un|fact"><span>id_on_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>FVars_UNss</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>pick_id_onss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>g_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.T_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tyenv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Sign.typ_match</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_type</span><span> </span><span class="entity"><span>tyenv</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.deads_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>plive_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>plives</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pbound_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pbounds</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pfree_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>pfrees</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>lives</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>bfrees</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="entity"><span>MRBNF_Def.mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plive_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>lives</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>pbound_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>frees</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pfree_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_rename_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deadss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_id_on_imagess</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on|const"><span class="const"><span>id_on</span></span></a></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_id_on</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.image_UN|fact"><span>image_UN</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>@</span><span> </span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
            </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>map_rename_ts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_onss</span></span><span> </span><span class="entity"><span>FVars_UNss</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_id_on_image'sss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on_image</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UN</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>UN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick_id_on_image</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_Un|fact"><span>id_on_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bfree_sets</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>FVars_UNs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>map_rename_ts</span></span><span> </span><span class="entity"><span>FVars_UNss</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>pick_id_on_imagess</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfrees</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bfree_ids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_PU_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>fst_const</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>bfree_ids</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_map_id_fsts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>fst_const</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>bfree_ids</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.incr_boundvars</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_GFP_Util.mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validP'_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
      </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_UPred'</span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_UPred</span></span><span> </span><span class="entity"><span>params</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_y_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UPred'</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span> </span><span class="entity"><span>ys</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_v_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UPred'</span></span><span> </span><span class="entity"><span>quot_PU_Ts</span></span><span> </span><span class="entity"><span>vs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_yy'_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>y_prems</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>y_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_y_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UPred'</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span> </span><span class="entity"><span>ys'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_vv'_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>v_prems</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>v_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_v_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_UPred'</span></span><span> </span><span class="entity"><span>quot_PU_Ts</span></span><span> </span><span class="entity"><span>vs'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Umap'_Uctor's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 10</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Umap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_id_fst</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PU_T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>PU_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>live_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_id_fst</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PUmap's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Umap's</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Uctor'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_ctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.fst_comp_map_prod|fact"><span>fst_comp_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_Uctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.map_cong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.case_prod_map_prod|fact"><span>case_prod_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.split_beta|fact"><span>split_beta</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_map_prod|fact"><span>fst_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_map_prod|fact"><span>snd_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.map_prod_simp|fact"><span>map_prod_simp</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute_def </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>total_abs_eq_iff </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>rep_abs_sym </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Umap's</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>valid_y_premss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_def2ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars_def</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.symmetric</span><span> </span><span class="entity"><span>FVars_def</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>rep_abs_sym </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_defs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_def2s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>FVars_def2ss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_subset_premsss</span></span><span> </span><span class="entity"><span>fps</span></span><span> </span><span class="entity"><span>UFVarsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map_filter</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>lsets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>NONE</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span>Logic.all</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>foldl1</span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fps</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>UFVarsss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>fps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subset_premsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subset_premsss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>subset_premsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subset_premsss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_subset_premsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subset_premsss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>quot_PU_setss</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>quot_subset_premsss'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_subset_premsss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>quot_PU_setss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UFVars'_subsetss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 11</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars's_transp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctor_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span>
            </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ctor_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ctor_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>int_empty_prem</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>subset_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>UFVars's_transp</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Uctor'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>FVars_def2s</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_ctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.fst_comp_map_prod|fact"><span>fst_comp_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVars_subsets </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_map_prod_id|fact"><span>exists_map_prod_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="entity"><span>valid_y_premss</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span> </span><span class="entity"><span>subset_premsss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Pmap_imsupp_empty</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap_cong_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>fp</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Uctor_renames</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>quot</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>PUmaps</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
          </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>live_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bfree_fs</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>int_empty_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concl</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Pmap_imsupp_empty</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>PUmaps</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_Uctor </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap_cong_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Uctor </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>set_rev_mp</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVars_subsets </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>axioms</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.Int_subset_empty1|fact"><span>Int_subset_empty1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.Int_Un_emptyI2|fact"><span>Int_Un_emptyI2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span>
            </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_assoc|fact"><span>Un_assoc</span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span>,</span></span></span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>(∩)</span></a></span><span>"</span></span><span class="main"><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span>
            </span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_image_subset|fact"><span>imsupp_image_subset</span></a><span class="main"><span>]</span></span><span>
          </span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quot_subset_premsss</span></span><span> </span><span class="entity"><span>quot_map_id_fsts</span></span><span> </span><span class="entity"><span>quot_PU_setss</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_v_premss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infinite_UNIV</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cinfinite_imp_infinite|fact"><span>cinfinite_imp_infinite</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.UNIV_cinfinite_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>comps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>g</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>g</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_mr_rel_prem</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>fps</span></span><span> </span><span class="entity"><span>PUmaps</span></span><span> </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span>o</span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>Term.incr_boundvars</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_Ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_prodT</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fps</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_case_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t'"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pu'"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>mk_rel</span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>fp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>valid_imp</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>4</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>3</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fps</span></span><span> </span><span class="entity"><span>PUmaps</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>MRBNF_Def.mk_mr_rel_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>live_Ts</span></span><span> </span><span class="entity"><span>live_Ts</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pbounds</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vars</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pfrees</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>bfrees</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>MRBNF_Def.interlace</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.eq_const</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>live_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pbound_ids</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>comps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>comps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pfree_ids</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>comps</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Uctor_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 12</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_premss'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor_rename</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>valid_vv'_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mr_rel_prem</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmaps</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>subset_premss'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>int_empty_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>v'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>valid_vv'_prems</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nvalid'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>valid_v_premss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_vv'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>g_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Uctor_rename</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nvalid'</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>take</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Uctor_rename</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nvalid'</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>drop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.mr_rel_eq_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.conversep_eq|fact"><span>conversep_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.relcompp_conversep_Grp|fact"><span>relcompp_conversep_Grp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_mono_strong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.case_prod_beta|fact"><span>case_prod_beta</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_def|fact"><span>Grp_UNIV_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_not_P|fact"><span>if_not_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vs</span></span><span> </span><span class="entity"><span>vs'</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>quot_subset_premsss</span></span><span> </span><span class="entity"><span>quot_subset_premsss'</span></span><span> </span><span class="entity"><span>quot_map_id_fsts</span></span><span> </span><span class="entity"><span>quot_PU_setss</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor_renames</span></span><span> </span><span class="entity"><span>valid_vv'_premss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>set_map_idss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>id_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>MRBNF_Def.Live_Var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>MRBNF_Def.Bound_Var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>MRBNF_Def.Free_Var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>id_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Uctor'_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 13</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subset_premss'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor_cong</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>valid_yy'_prems</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_imsupp_prems</span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>gs</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_int_empty_prems</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="entity"><span>gs</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_mr_rel_prem</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="entity"><span>y'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>fp</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>subset_premss</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>subset_premss'</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>int_empty_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars'_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars_def2ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>valid_yy'_prems</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>gs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_yy'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>g_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>Uctor'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Uctor_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>drop</span><span> </span><span class="entity"><span>nvalid</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>set_map_idss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_map_prod_id|fact"><span>exists_map_prod_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>FVars'_defs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Goal.assume_rule_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor_def </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>#</span></span><span>FVars_defs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span class="main"><span class="main"><span>,</span></span></span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.union|const"><span>(∪)</span></a></span><span>"</span></span><span class="main"><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span class="main"><span>,</span></span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.union|const"><span>(∪)</span></a></span><span>"</span></span><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>(∩)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_trans </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_intro </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_id|fact"><span>id_on_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.fst_comp_map_prod|fact"><span>fst_comp_map_prod</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.mr_rel_def_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.map_id_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.rel_refl_strong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span>THEN_ALL_NEW</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_Composition.html#MRBNF_Composition.Grp_OO|fact"><span>Grp_OO</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>refl</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.conversep_eq|fact"><span>conversep_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.relcompp_conversep_Grp|fact"><span>relcompp_conversep_Grp</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_Composition.html#MRBNF_Composition.Grp_OO|fact"><span>Grp_OO</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_mono_strong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.case_prod_beta|fact"><span>case_prod_beta</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_map_prod|fact"><span>fst_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_map_prod|fact"><span>snd_map_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute_def </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>total_abs_eq_iff </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM_N</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_trans </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PUmaps</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Umap's</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>ys'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subset_premsss</span></span><span> </span><span class="entity"><span>subset_premsss'</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>Uctor_congs</span></span><span> </span><span class="entity"><span>valid_yy'_premss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Umap'_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Umap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>total_abs_eq_iff </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>Umap's</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PUmap'_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Umap'_alpha</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Umap'_alpha</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>Umap'_alphas</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>a</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_premsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>concl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="entity"><span>concl</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>concls</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impE</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_f_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pck</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pck</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pick_premsss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rec_n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_ons</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>v</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rename_t</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>rec_n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_t2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>live_ts</span></span><span>
          </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t2</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span class="const"><span>fst</span></span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_intro </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.conversep_eq|fact"><span>conversep_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.inv_o_simp1|fact"><span>inv_o_simp1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>,</span></span><span>
          </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.relcompp_conversep_Grp|fact"><span>relcompp_conversep_Grp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.mr_rel_def_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.map_id_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.rel_refl_strong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>refl</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_id_ons</span></span><span> </span><span>THEN'</span><span> </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>pick_id_onss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_int_empty_goal</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>XX</span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="entity"><span>ctor</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span>Logic.mk_implies</span><span> </span><span>o</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>XX_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>XX_t</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctor</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>XX_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pick_premsss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_XXlss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XXl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_int_empty_goal</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>XXl</span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Pmap_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Pmap </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>::</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>valid_Pmap_prems</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XXl</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span class="const"><span>fst</span></span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.image_UN|fact"><span>image_UN</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.image_Int_empty|fact"><span>image_Int_empty</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVars_Pmaps </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>valid_Pmap_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.imsupp_image_empty_IntI|fact"><span>imsupp_image_empty_IntI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_commute|fact"><span>Int_commute</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>valid_Pmap_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_Int|fact"><span>image_Int</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_is_empty|fact"><span>image_is_empty</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>valid_Pmap_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_Int|fact"><span>image_Int</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_is_empty|fact"><span>image_is_empty</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Diff_disjoint|fact"><span>Diff_disjoint</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>XXls</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empty_XXrss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XXr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_int_empty_goal</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="entity"><span>XXr</span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>rel</span></span><span> </span><span>+</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nrec_bd</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XXr</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span class="const"><span>fst</span></span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.image_UN|fact"><span>image_UN</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span>oo</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_image|fact"><span>id_on_image</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="entity"><span>pick_id_on_image'sss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.image_Un|fact"><span>image_Un</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>MRBNF_Def.bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>MRBNF_Def.free_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>prems'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>XXrs</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>UFVars'_alphass</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>UFVars'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>UFVars</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>arg_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>total_abs_eq_iff </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>UFVarss </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conj_spec</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conj_mp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_conj_thms</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_f_opts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span>Option.isSome</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>validity</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>validP</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="entity"><span>validP</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>U </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> prems</span><span class="main"><span>=</span></span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="main"><span>#</span></span><span>subshape_induct </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Basic_BNFs.html#Basic_BNFs.pred_funI|fact"><span>pred_funI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>exhaust </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>Uctor'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Uctor</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.snd_comp_map_prod|fact"><span>snd_comp_map_prod</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.snd_comp_mk_prod|fact"><span>snd_comp_mk_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>Subgoal.FOCUS_PREMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.pred_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_True_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.ballI|fact"><span>ballI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.pred_fun_If|fact"><span>pred_fun_If</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span>
                    </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>c</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_all</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_UFVars'ss</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goalss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>mk_leq</span></span><span>
              </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goalss</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_all</span></span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>goal</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mp</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span>~</span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conj_mp</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>result</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conj_spec</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>subshape_induct </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span>
            </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span>
              </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span>o</span><span> </span><span>hd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>exhaust </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>hyp_subst_tac_thin</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>Subgoal.FOCUS_PREMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apfst</span><span> </span><span>single</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>swap</span></span><span> </span><span class="main"><span>(</span></span><span>split_last</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mp</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                    </span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.mp|fact"><span>mp</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>IHs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>IH</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span>foldl1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>RS</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>IH</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>spec</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>conjunct2</span></span><span>
                      </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conjunct1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems'</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>UFVars'_alphass</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>UFVars'_subsetss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.snd_comp_mk_prod|fact"><span>snd_comp_mk_prod</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.pred_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_True_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.ballI|fact"><span>ballI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.pred_fun_If|fact"><span>pred_fun_If</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                      </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_f_opts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span>
                    </span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>all_tac</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnE</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                      </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj</span></span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_conj</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="entity"><span>result</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

   </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>map2_prod</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>a</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>b</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXl_UFVars'sss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXr_UFVars'sss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>map2_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XXs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 6</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subshapes</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XX</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lsets</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>subshape</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f_UFVars'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>raw'</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>IHs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>Logic.all</span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.all</span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>subshape</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f'</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
                    </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f'</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
                  </span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>XX_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_mem</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>foldl1</span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>XX_t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsets</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_leq</span></span><span>
                  </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>UFVars'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>validP'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prems</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span>
                  </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span>
                  </span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnE|fact"><span>UnE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>hyp_subst_tac_thin</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="entity"><span>left</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>IHs</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>raw'</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_UFVars'</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span>
              </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>pus</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>lsets</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>subshapes</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>UFVars'ss</span></span><span> </span><span class="entity"><span>f_UFVars'ss</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>subshapess </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span> </span><span class="entity"><span>XXs</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>true</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>foldr1</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>+</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXlss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imsupp_id_on_XXrss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>
      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lsets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_onss'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on_imagess'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XX</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 9</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars_transps</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
            </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>w</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"w"</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>XX_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>As</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>::</span><span>
              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map_filter</span></span><span> 2</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_UNION</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>lsets</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>FVars</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>mk_minus</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>FVars_transps</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>XX_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span>
                </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_id_on</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_image</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>As</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>w</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prems</span></span><span>
                </span><span>|&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span>
                </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span>
                </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span class="const"><span>fst</span></span></a></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.image_UN|fact"><span>image_UN</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_image|fact"><span>id_on_image</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_onss'</span></span><span class="main"><span>)</span></span><span>
                  </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_image|fact"><span>id_on_image</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on_imagess'</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span>
              </span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>transpose</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span class="entity"><span>fsets</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span>length</span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="entity"><span>pre_setss</span></span><span> </span><span class="entity"><span>pick_id_onsss'</span></span><span> </span><span class="entity"><span>pick_id_on_image'sss</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Cinfinite_UNIV</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>conjI</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.UNIV_cinfinite_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>regularCard_UNIV</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span>var_regular </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.class_thms_of_mrbnf</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>regularCard_card</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>#</span></span><span>min_bound </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Cinf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_Cinfinite|fact"><span>cmin_Cinfinite</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a1</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_regularCard|fact"><span>cmin_regularCard</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>regularCard_UNIV</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Cinf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a1</span></span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Cinfinite_UNIV</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cinfinite_UNIV</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>regularCard_UNIV</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Cinfinite_UNIV</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>regularCard_UNIV</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Un_bound</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Card_Prelim.html#Card_Prelim.regularCard_Un|fact"><span>regularCard_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conjunct2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjunct1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>regularCard_card</span></span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_PUmap's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Umap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred_fun</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_fun</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pred_fun</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Basic_BNFs.html#Basic_BNFs.pred_funI|fact"><span>pred_funI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Umap </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Basic_BNFs.html#Basic_BNFs.pred_fun_def|fact"><span>pred_fun_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mp</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span>
          </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>Umap's</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>pus</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_XXrs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists</span><span> </span><span>Option.isSome</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span>
      </span><span>apply2</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span>
        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XX</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
            </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>MRBNF_Def.mk_pred_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span> </span><span class="entity"><span>frees</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span>
            </span><span>map</span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="entity"><span>plives</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PU_T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="entity"><span>pred</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pred_True</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.dest_prodT</span></span><span> </span><span class="entity"><span>PU_T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>snd_const</span></span><span> </span><span class="entity"><span>PU_T</span></span><span>
              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prod_PU_Ts</span></span><span> </span><span class="entity"><span>models</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XX</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span>@</span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.snd_comp_mk_prod|fact"><span>snd_comp_mk_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.pred_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_True_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.pred_fun_If|fact"><span>pred_fun_If</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>o</span><span> </span><span>Option.map</span><span> </span><span>single</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_PUmap's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_f_opts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnfs</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>xs</span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXrs</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_PUmap'_If</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p'"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>P </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>BNF_GFP_Util.mk_undefined</span></span><span> </span><span class="main"><span>(</span></span><span>range_type</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>valid_Pmap </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>pus</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>PUmap'_congs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Umap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pu</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pu'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>"'"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Pmap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pu</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pu'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Umap'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span>ORELSE'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>Umap's</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span> </span><span class="entity"><span>pus</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>$</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>fst</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_swap_alpha</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>alpha_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>$</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span>$</span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>foldr1</span><span> </span><span class="entity"><span>HOLogic.mk_conj</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add_imp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>I</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>insts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_prem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fold_rev</span><span> </span><span class="entity"><span>mk_all</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>dest_Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="entity"><span>add_imp</span></span><span> </span><span class="main"><span>(</span></span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span>curry</span><span> </span><span class="entity"><span>HOLogic.mk_imp</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span>
              </span><span>@</span><span> </span><span class="entity"><span>suitable'_prems</span></span><span>
              </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.dest_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_prem</span></span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span> </span><span class="entity"><span>alpha_prems</span></span><span> </span><span class="entity"><span>goals</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ts'</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>alpha_prems</span></span><span class="main"><span>)</span></span><span>
      </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>apply_n</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>spec_n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>m</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mp_n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>m</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>induct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>subshape_induct </span><span class="entity"><span>fp_thms</span></span><span>
            </span><span>|&gt;</span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>insts</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>apply_n</span></span><span> </span><span class="entity"><span>conj_spec</span></span><span> </span><span class="entity"><span>spec_n</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>apply_n</span></span><span> </span><span class="entity"><span>conj_mp</span></span><span> </span><span class="entity"><span>mp_n</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>induct</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>n</span></span><span> </span><span>o</span><span> </span><span>defer_tac</span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
          </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 22</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>map_id_fst</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PU_bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XXl</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>XXr</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'_alpha</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>int_empty_XXls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>int_empty_XXrs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'_cong</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>imsupp_id_on_XXls</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PUmap'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_id_on_image'ss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_elim </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>hyp_subst_tac_thin</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><span>triv_forall_equality</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>Subgoal.FOCUS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span> params</span><span class="main"><span>=</span></span><span class="entity"><span>ps</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>n'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>n</span></span><span> </span><span>&gt;</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rec_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>IHs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>prems</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>n'</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>apsnd</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>IHs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>apply_n</span></span><span> </span><span class="entity"><span>mp</span></span><span> </span><span class="entity"><span>mp_n</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>apply_n</span></span><span> </span><span class="entity"><span>spec</span></span><span> </span><span class="entity"><span>spec_n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>fold_map</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs</span></span><span class="main"><span>)</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="main"><span>#</span></span><span>valid_Pmap </span><span class="entity"><span>v</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ps</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>ps</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chop_f_prems</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>valid_Pmap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span>single</span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>xs</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pick_prems</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>xs</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>valid_Pmap_opt</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick's</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rest</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
                  </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ps</span></span><span>
                    </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span>chop</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
                    </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span>
                    </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span>
                    </span><span>||&gt;&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>m</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>hs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rest</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>chop</span><span> </span><span class="entity"><span>nvars</span></span><span>
                  </span><span>||&gt;&gt;</span><span> </span><span>apply2</span><span> </span><span>hd</span><span> </span><span>o</span><span> </span><span>chop</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable'_premss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exists_bij_betw's</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>rename_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>R</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>map_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>L</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_comp</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>XXl_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XXl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>XXr_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>XXr</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span>o</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>R</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bset</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXl_t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span>
                    </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>XXr_t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_bij_betw_refl_def|fact"><span>exists_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PU_bsets</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exists_bij_betws</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>exE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_id_fst</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exists_bij_betw's</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>

                </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bound_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span class="main"><span>,</span></span><span>
                  </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Un_bound</span></span><span class="main"><span>,</span></span><span>
                  </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>small_PFVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>card_of_FVars_bound_UNIVs </span><span class="entity"><span>raw</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>small_avoiding_sets </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span class="main"><span>(</span></span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span class="entity"><span>MRBNF_Def.set_bd_UNIV_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>MRBNF_Def.live_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>MRBNF_Def.free_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>MRBNF_Def.bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_ctor </span><span class="entity"><span>raw</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>λ</span></span><span class="bound"><span>t</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span class="bound"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="bound"><span>t</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>XXr</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>PUmap'_alpha</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>PUmap'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Umap'_Uctor's</span></span><span class="main"><span>,</span></span><span>
                </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_Pmap</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.snd_comp_mk_prod|fact"><span>snd_comp_mk_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.pred_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_True_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.ballI|fact"><span>ballI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.pred_fun_If|fact"><span>pred_fun_If</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_f_opts</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="main"><span>#</span></span><span>Pmap_comp0 </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.inv_o_simp2|fact"><span>inv_o_simp2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_prems</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>Pmap_id0 </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.comp_pair|fact"><span>comp_pair</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>K</span><span> </span><span>all_tac</span><span> </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span>~</span><span class="entity"><span>pre_n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.map_cong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pre_n</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>rec_n</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_cong|fact"><span>if_cong</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>valid_PUmap'_If</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.symmetric</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>XXl</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>bound_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>thms</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>XXl</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>XXr</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.ordLeq_refl|fact"><span>ordLeq_refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin1|fact"><span>cmin1</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin2|fact"><span>cmin2</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>int_empty_XXls</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>int_empty_XXrs</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exists_bij_betws</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>r</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span>+</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>valid_XXls</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor'_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>defer_tac</span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_XXls</span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_XXrs</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>XXl_UFVars'sss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>THEN'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>IH</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>IH</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span> </span><span>THEN'</span><span> </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>XXr_UFVars'sss</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>defer_tac</span><span class="main"><span>,</span></span><span>
                </span><span class="comment1"><span>(* mr_rel_goal *)</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>XXl</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>XXr</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.conversep_eq|fact"><span>conversep_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_def_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>::</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.relcompp_conversep_Grp|fact"><span>relcompp_conversep_Grp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.rel_cong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>trans</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_cong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.map_id_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="comment1"><span>(* comp = id for free position *)</span></span><span>
                  </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.inv_id_middle|fact"><span>inv_id_middle</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv|const"><span class="const"><span>inv</span></span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>imsupp_id_on_XXls</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_inv|fact"><span>id_on_inv</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="comment1"><span>(* comp = id for bound position *)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.inv_id_middle2|fact"><span>inv_id_middle2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_onD|fact"><span>eq_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>bound_tac</span></span><span> </span><span>ORELSE'</span><span>
                  </span><span class="comment1"><span>(* comp = id for bound free position *)</span></span><span>
                  </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>bound_tac</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffI|fact"><span>DiffI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.inv_id_middle2|fact"><span>inv_id_middle2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.comp_middle|fact"><span>comp_middle</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on_image'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.rel_refl_strong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span> </span><span>ORELSE'</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.fun_cong|fact"><span>fun_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_def|fact"><span>Grp_UNIV_def</span></a><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="comment1"><span>(* recursive nonbinding set *)</span></span><span>
                    </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.context_conjI|fact"><span>context_conjI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_bij </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.UN_I|fact"><span>UN_I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="comment1"><span>(* recursive binding set *)</span></span><span>
                    </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                        </span><span class="main"><span>]</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.context_conjI|fact"><span>context_conjI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_bij </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="comment1"><span>(* nonbinding_case *)</span></span><span>
                        </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXlss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_id_on_XXrss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.UN_I|fact"><span>UN_I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="comment1"><span>(* binding_case *)</span></span><span>
                        </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_onD|fact"><span>eq_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffI|fact"><span>DiffI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.UN_I|fact"><span>UN_I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_Pmap</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                              </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>valid_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>imsupp_id_on_XXls</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_id_on_XXrs</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                            </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                            </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.comp_middle|fact"><span>comp_middle</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                            </span><span class="main"><span>]</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>imageI</span></span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on_image'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_PUmap'_If</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>PUmap'_congs</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                      </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span>
                    </span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_def|fact"><span>eq_bij_betw_refl_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                    </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_PUmap'_If</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_empty|fact"><span>imsupp_id_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                    </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                  </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                  </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_refl_prems|fact"><span>eq_bij_betw_refl_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                      </span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span class="main"><span>]</span></span><span>
                </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="comment1"><span>(*    f picks t = f picks' t' *)</span></span><span>
                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span class="entity"><span>Subgoal.FOCUS_PARAMS</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_bijss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>every_other</span></span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick'_bijss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>every_other</span></span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exists_bij_betw2s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_bij</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick'_bij</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>h_bij</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cbset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bset</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_map_t</span></span><span> </span><span class="entity"><span>xx</span></span><span> </span><span class="entity"><span>picks</span></span><span> </span><span class="main"><span>=</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                            </span><span class="comment1"><span>(* TODO: fix for multiple bounds *)</span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>chop_rec</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>;</span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>pick</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>xx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pickss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rename_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span>
                                </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rel</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>member</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span class="main"><span>=</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>rel</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>pick_t</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>var</span></span><span>
                                </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>binding_relation </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span>
                              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rename_t</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>rename_t</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>nrecs</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>map_id_fst</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                            </span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="entity"><span>pick_ts</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>bfree_vars </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span>
                          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick'_map_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_t</span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="entity"><span>pick's</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pick_map_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_t</span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="entity"><span>picks</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>FVars_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span>
                          </span><span class="entity"><span>FVars</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span>
                        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>cbset</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cbset</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>pick'_map_t</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>FVars_t</span></span><span class="main"><span>,</span></span><span>
                        </span><span>NONE</span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>pick_map_t</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
                        </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_bij_betw_def|fact"><span>exists_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pick_bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pick'_bij</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>h_bij</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick_bijss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick'_bijss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>every_other</span></span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVarss </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_sets'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.Live_Var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
                      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="entity"><span>thm</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_set_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mr_rel_sets</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_sets'</span></span><span class="main"><span>;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
                    </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>exE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mr_rel_sets</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>EVERY'</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitables</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>bound_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>alpha_ctor_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitables</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitables</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.ordLeq_refl|fact"><span>ordLeq_refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin1|fact"><span>cmin1</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin2|fact"><span>cmin2</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>exists_bij_betw2s</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>exE</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>n'</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span>+</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>valid_XXls</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor'_cong</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM_N</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>defer_tac</span><span class="main"><span>,</span></span><span>
                    </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.snd_comp_mk_prod|fact"><span>snd_comp_mk_prod</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.pred_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.pred_True_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.ballI|fact"><span>ballI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.impI|fact"><span>impI</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.TrueI|fact"><span>TrueI</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.pred_fun_If|fact"><span>pred_fun_If</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_f_opts</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnE</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>imageE</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>f_UFVars'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span class="main"><span>]</span></span><span>
                      </span><span class="main"><span>]</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="comment1"><span>(* mr_rel_goal *)</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>nth</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv_id|fact"><span>inv_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_id|fact"><span>Grp_UNIV_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.OO_eq|fact"><span>OO_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.conversep_eq|fact"><span>conversep_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.relcompp_conversep_Grp|fact"><span>relcompp_conversep_Grp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_mono_strong0_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.free_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>MRBNF_Def.bound_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                      </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                    </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                    </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                      </span><span class="comment1"><span>(* comp = id for free position *)</span></span><span>
                      </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_apply|fact"><span>id_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv|const"><span class="const"><span>inv</span></span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_inv|fact"><span>id_on_inv</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_sets</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="comment1"><span>(* passive bound/free position *)</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="comment1"><span>(* passive live position *)</span></span><span>
                      </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="comment1"><span>(* comp = id for bound position *)</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>bound_tac</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.o_inv_distrib|fact"><span>o_inv_distrib</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.bij_imp_inv&apos;|fact"><span>bij_imp_inv'</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_onD|fact"><span>eq_onD</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
                      </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ballI</span></span><span> </span><span>THEN'</span><span> </span><span class="entity"><span>bound_tac</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span>
                      </span><span class="comment1"><span>(* comp = id for bound free position *)</span></span><span>
                      </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.ballI|fact"><span>ballI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>bound_tac</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffI|fact"><span>DiffI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.contrapos_pp|fact"><span>contrapos_pp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_iff|fact"><span>Un_iff</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.de_Morgan_disj|fact"><span>de_Morgan_disj</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.bij_imp_inv&apos;|fact"><span>bij_imp_inv'</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable'_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span class="const"><span>minus</span></span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>MRBNF_Def.Live_Var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
                            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.mr_rel_set_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>~~</span><span> </span><span class="entity"><span>MRBNF_Def.var_types_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_set_diff|fact"><span>image_set_diff</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_is_inj|fact"><span>bij_is_inj</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_image|fact"><span>id_on_image</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_antimono|fact"><span>id_on_antimono</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_assoc|fact"><span>Un_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.subset_refl|fact"><span>subset_refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_upper1|fact"><span>Un_upper1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp|const"><span>∘</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_apply|fact"><span>comp_apply</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.set_map_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong|fact"><span>arg_cong</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.inv|const"><span class="const"><span>inv</span></span></a><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffE|fact"><span>DiffE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_inv|fact"><span>id_on_inv</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>rotated</span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_intro </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffE|fact"><span>DiffE</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>,</span></span><span>
                      </span><span class="comment1"><span>(* rec sets *)</span></span><span>
                      </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>no_tac</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>fp_thms</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ballI</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Relation.html#Relation.relcomppI|fact"><span>relcomppI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.Grp_UNIV_def|fact"><span>Grp_UNIV_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.context_conjI|fact"><span>context_conjI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="comment1"><span>(* nonbinding rec set *)</span></span><span>
                          </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_bij </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_pick</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>
                                </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>alpha_FVars</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>alpha_pick</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span>
                              </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                            </span><span class="main"><span>]</span></span><span>
                          </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="comment1"><span>(* binding rec set *)</span></span><span>
                          </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                              </span><span class="main"><span>]</span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_trans </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>~1</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_bij </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                                  </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                  </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span class="main"><span>,</span></span><span>
                                  </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM1</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.id_on_eq|fact"><span>id_on_eq</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.union|const"><span>(∪)</span></a></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_intro </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>UnI1</span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                              </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.eq_onI|fact"><span>eq_onI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>_</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>∈</span></a></span><span> </span><span class="main"><span>_</span></span><span>"</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_onD|fact"><span>eq_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>forward_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffI|fact"><span>DiffI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.UN_I|fact"><span>UN_I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>,</span></span><span>
                                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_on_Un|fact"><span>id_on_Un</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.id_on_comp3|fact"><span>id_on_comp3</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>OF</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                                </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_permutes </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>dresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>
                                  </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.not_member|const"><span>(∉)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span>
                                  </span><span class="entity"><span>MRBNF_Def.mr_rel_flip_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mr_rel_prem</span></span><span>
                                </span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>mr_rel_sets'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.not_imageI|fact"><span>not_imageI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>,</span></span><span>
                                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.image_comp|fact"><span>image_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.inv_o_simp2|fact"><span>inv_o_simp2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>,</span></span><span>
                                </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.image_id|fact"><span>image_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.DiffI|fact"><span>DiffI</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Complete_Lattices.html#Complete_Lattices.UN_I|fact"><span>UN_I</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                                </span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>FVarss</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>rotate_tac</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable'_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_trans </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>alpha_intro </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mr_rel_prem</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_id_ons</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.id_on_comp2|fact"><span>id_on_comp2</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>p</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p</span></span><span>::</span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                                </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_premss</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pick_id_on'ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                                </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_id_on|fact"><span>imsupp_id_on</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.id_onD|fact"><span>id_onD</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.UnI1|fact"><span>UnI1</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="main"><span class="main"><span class="main"><span>_</span></span></span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.member|const"><span>(∈)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_FVarss </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>valid_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>FVars_intross </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                              </span><span class="main"><span>]</span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                              </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                              </span><span class="entity"><span>mk_arg_cong</span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>raw</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>4</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                              </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                            </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>valid_PUmap'_If</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                        </span><span class="main"><span>]</span></span><span> </span><span>ORELSE'</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>IH</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>IH</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshapess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM_N</span><span> </span><span class="entity"><span>m</span></span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitable_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>prefer_tac</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>5</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>nvars</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>*</span><span> </span><span class="entity"><span>m</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span>+</span><span> </span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>fun_cong</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>thm</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>PUmap'_alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>PUmap'_congs</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>raw</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>permute_id </span><span class="entity"><span>raw</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                            </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>IHs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.rotate_prems</span><span> </span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>set_subshape_permutess </span><span class="entity"><span>fp_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>the_default</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>single</span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>valid_Pmap</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.bij_imp_bij_inv|fact"><span>bij_imp_bij_inv</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_inv_bound|fact"><span>supp_inv_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.imsupp_id|fact"><span>imsupp_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>(∩)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_empty_left|fact"><span>Int_empty_left</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>maps</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>raw</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>permute_id </span><span class="entity"><span>raw</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_def|fact"><span>eq_bij_betw_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
                          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.imsupp_id|fact"><span>imsupp_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.inter|const"><span>(∩)</span></a></span><span>"</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_empty_left|fact"><span>Int_empty_left</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>ORELSE'</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_asm_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_comp_bound|fact"><span>supp_comp_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_comp|fact"><span>bij_comp</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>infinite_UNIV</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_trans </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_o|fact"><span>id_o</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.o_id|fact"><span>o_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_assoc|fact"><span>comp_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>permute_comp </span><span class="entity"><span>raw</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>card_thms</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
                          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>iffD2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>alpha_bij_eq </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>h_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'_prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>eresolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.eq_bij_betw_prems|fact"><span>eq_bij_betw_prems</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>card_thms</span></span><span>
                          </span><span class="main"><span>]</span></span><span>
                        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_sym </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>fp_thms </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>]</span></span><span>
                  </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
            </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
          </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ys</span></span><span> </span><span class="entity"><span>map_id_fsts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="entity"><span>PU_setss</span></span><span> </span><span class="entity"><span>pre_setss</span></span><span> </span><span class="entity"><span>XXls</span></span><span> </span><span class="entity"><span>XXrs</span></span><span> </span><span class="entity"><span>deadss</span></span><span>
          </span><span class="entity"><span>PUmap'_alphas</span></span><span> </span><span class="entity"><span>alpha_ctor_picks</span></span><span> </span><span class="entity"><span>int_empty_XXlss</span></span><span> </span><span class="entity"><span>int_empty_XXrss</span></span><span> </span><span class="entity"><span>Uctor'_congs</span></span><span>
          </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="entity"><span>imsupp_id_on_XXlss</span></span><span> </span><span class="entity"><span>imsupp_id_on_XXrss</span></span><span> </span><span class="entity"><span>PUmap's</span></span><span> </span><span class="entity"><span>pick_id_onsss'</span></span><span> </span><span class="entity"><span>pick_id_on_image'sss</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>exists_suitabless</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_exists</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"pick"</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_funT</span><span> </span><span class="main"><span>(</span></span><span>fastype_of</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.choice|fact"><span>choice</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.allI|fact"><span>allI</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_suitable_aux|fact"><span>exists_suitable_aux</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.exists_suitable_aux|fact"><span>exists_suitable_aux</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="main"><span class="main"><span>_</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span class="const"><span>True</span></span></a></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>15</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Arithmetic.html#BNF_Cardinal_Arithmetic.ordLeq_refl|fact"><span>ordLeq_refl</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin1|fact"><span>cmin1</span></a><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin2|fact"><span>cmin2</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Wellorder_Constructions.html#BNF_Wellorder_Constructions.ordLeq_ordLess_trans|fact"><span>ordLeq_ordLess_trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL-Cardinals/Cardinal_Order_Relation.html#Cardinal_Order_Relation.card_of_diff|fact"><span>card_of_diff</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
            </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Un_bound</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>MRBNF_Def.set_bd_UNIV_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span>
            </span><span>@</span><span> </span><span>maps</span><span> </span><span class="main"><span>#</span></span><span>card_of_FVars_bound_UNIVs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span>
            </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>small_PFVarss </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>small_avoiding_sets </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>axioms </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span>
            </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="main"><span>]</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ex_suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span>fst</span><span> </span><span class="entity"><span>pick0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>pick0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ex_suitable</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>exists_suitabless</span></span><span> </span><span class="entity"><span>pick0ss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_swap_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>t2</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>conjunct2</span></span><span> </span><span>@</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>conjunct1</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_swap_alpha</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>r</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rec_f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pickss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>rec_f</span></span><span class="main"><span>,</span></span><span> </span><span>flat</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pickss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>pick'ss</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_prems</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>suitable'_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_swap_alphas</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.cmin_greater|fact"><span>cmin_greater</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/BNF_Cardinal_Order_Relation.html#BNF_Cardinal_Order_Relation.card_of_Card_order|fact"><span>card_of_Card_order</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.imsupp_id|fact"><span>imsupp_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_empty_left|fact"><span>Int_empty_left</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>ORELSE'</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rec_fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f0_alphas</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>addPred</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.mk_implies</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>f0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_alphas</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>ts'</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f0_UFVars'ss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.symmetric</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>f0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f0s</span></span><span> </span><span class="entity"><span>f_UFVars'ss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f0_ctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 8</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>raw</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empties</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>noclash </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>f0s</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>raw</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>live_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>bfree_ids</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>int_empties</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>noclash</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x'"</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"p'"</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
          </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>suitable_pick1s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 4</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pick0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>suitable_pick0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>suitable</span></span><span> </span><span>$</span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>x'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="entity"><span>BNF_FP_Util.mk_If</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_eq</span></span><span> </span><span class="main"><span>(</span></span><span>apply2</span><span> </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.id_const</span></span><span> </span><span class="entity"><span>var</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>pick0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x'</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p'</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allI</span></span><span class="main"><span>,</span></span><span>
              </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impI</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>suitable_pick0</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>suitable</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>allE</span></span><span class="main"><span>,</span></span><span>
              </span><span>TRY</span><span> </span><span>o</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>impE</span></span><span> </span><span>THEN'</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="main"><span>[</span></span><span class="entity"><span>conjunct1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>conjunct2</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>Cinfinite_card</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
                  </span><span>@</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.bij_if|fact"><span>bij_if</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.supp_if&apos;|fact"><span>supp_if'</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.imsupp_if_empty|fact"><span>imsupp_if_empty</span></a><span> </span><a class="entity_ref" href="../../../../../Binders/MRBNF_FP.html#MRBNF_FP.image_if_empty|fact"><span>image_if_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>dtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.iffD1|fact"><span>iffD1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>hyp_subst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_assoc|fact"><span>Un_assoc</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>#</span></span><span>FVars_ctors </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>drop</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span> </span><span>+</span><span> </span><span class="entity"><span>nvars</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Int_Un_distrib|fact"><span>Int_Un_distrib</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Un_empty|fact"><span>Un_empty</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>noclash </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>etac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjE</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>conjI</span></span><span class="main"><span>,</span></span><span>
              </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>FIRST'</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
                </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Set.html#Set.Diff_disjoint|fact"><span>Diff_disjoint</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>]</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitabless</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>pick0ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>nth</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vars</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
          </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>f0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_alphas</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_pick1s</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>raw</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
          </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>rec_fs</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_pick1s</span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>infer_instantiate'</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>Uctor'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.arg_cong2|fact"><span>arg_cong2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>MRBNF_Def.map_cong_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>#</span></span><span>permute_id </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ext</span></span><span class="main"><span>,</span></span><span>
            </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.case_split|fact"><span>case_split</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.trans|fact"><span>trans</span></a><span class="main"><span>[</span></span><span class="operator"><span>rotated</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_P|fact"><span>if_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
              </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f_alphas</span></span><span class="main"><span>,</span></span><span>
            </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
            </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span>
              </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod.inject|fact"><span>prod.inject</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>suitable_pick1s</span></span><span>
            </span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>f0s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span class="main"><span>,</span></span><span>
            </span><span>TRY</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
              </span><span>SELECT_GOAL</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/HOL.html#HOL.if_not_P|fact"><span>if_not_P</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
              </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
            </span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>upto</span><span> </span><span class="entity"><span>r</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Uctor's</span></span><span> </span><span class="entity"><span>xs</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>pre_setss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>f0_swaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>[</span></span><span>Thm.symmetric</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="entity"><span>f0</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>Drule.rotate_prems</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>alpha_refl </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>raw_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> _</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>@</span><span> </span><span>flat</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>suitable_pick0ss</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>conjunct1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f_swap_alphas</span></span><span> </span><span class="entity"><span>f0s</span></span><span class="main"><span>;</span></span><span>

    </span><span class="comment1"><span>(* Final result lemmas *)</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ff0_valids</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>v</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ff_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>quot</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>params</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span>
          </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ff_t</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_pred_fun</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pred </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ff_t</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="entity"><span>goal</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>...</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>ff0</span></span><span class="main"><span>,</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>f0</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>the</span><span> </span><span class="entity"><span>valid_f_opts</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>suitable_pick0ss</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>validity </span><span class="entity"><span>model</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span> </span><span class="entity"><span>f0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>models</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ff0_cctors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 7</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Uctor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bsets</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>int_empties</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 3</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bset</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>PFVars</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>bset</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_Un</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PFVars</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bsets</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>PFVarss </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>noclash</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>noclash </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>live_ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Term.absfree</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valid_If</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>f0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor </span><span class="entity"><span>quot</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
          </span><span class="entity"><span>Uctor</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_map_comb_of_mrbnf</span></span><span> </span><span class="entity"><span>deads</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>replicate_rec</span></span><span> </span><span class="entity"><span>live_ts</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>ids</span></span><span> </span><span class="entity"><span>bfree_ids</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>int_empties</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>noclash</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span class="entity"><span>Method.insert_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>ctor_def </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>ff0s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f0_alphas</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f0_ctors</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>set_map_idss</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>iffD1</span></span><span> </span><span>OF</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>nnoclash_noclash </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>assume_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="entity"><span>Uctor's</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>EVERY'</span><span> </span><span class="main"><span>[</span></span><span>
          </span><span class="entity"><span>EqSubst.eqsubst_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>MRBNF_Def.map_comp_of_mrbnf</span></span><span> </span><span class="entity"><span>mrbnf</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
          </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../Prelim/Prelim.html#Prelim.supp_id_bound|fact"><span>supp_id_bound</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.bij_id|fact"><span>bij_id</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.comp_def|fact"><span>comp_def</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Product_Type.html#Product_Type.map_prod_simp|fact"><span>map_prod_simp</span></a><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
          </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms</span></span><span> </span><a class="entity_ref" href="../../../../../../HOL/HOL/Fun.html#Fun.id_def|fact"><span>id_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>abs_rep </span><span>o</span><span> </span><span class="main"><span>#</span></span><span>inner</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pre_mrbnfs </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>#</span></span><span>Uctor </span><span class="entity"><span>models</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>xs'</span></span><span> </span><span class="entity"><span>deadss</span></span><span> </span><span class="entity"><span>quot_pre_setss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ff0_swaps</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>model</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f0_alpha</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>dest_Free</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>imsupp_prems</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.mk_Trueprop</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span class="entity"><span>mk_int_empty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_imsupp</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>avoiding_set</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>fs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>avoiding_sets </span><span class="entity"><span>params</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Trueprop_eq</span></span><span> </span><span class="main"><span>(</span></span><span>
          </span><span>fst</span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>permute </span><span class="entity"><span>quot</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>,</span></span><span>
          </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Umap </span><span class="entity"><span>model</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>t</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Term.list_comb</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>Pmap </span><span class="entity"><span>params</span></span><span class="main"><span>,</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>mk_inv</span></span><span> </span><span class="entity"><span>fs</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>p</span></span><span>
          </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Goal.prove_sorry</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>fs</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>t</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>p</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>validP_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>f_prems</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>imsupp_prems</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>goal</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>{</span></span><span>context</span><span class="main"><span>=</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>EVERY1</span><span> </span><span class="main"><span>[</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span>snd</span><span> </span><span class="entity"><span>ff0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>permute_def </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f0_alpha</span></span><span class="main"><span>,</span></span><span>
        </span><span>TRY</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep_abs </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>trans</span></span><span class="main"><span>,</span></span><span>
        </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>f0_swaps</span></span><span class="main"><span>,</span></span><span>
        </span><span>REPEAT_DETERM</span><span> </span><span>o</span><span> </span><span>resolve_tac</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>prems</span></span><span class="main"><span>,</span></span><span>
        </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>unfold_thms_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>PUmap's</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>Umap's</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_rep </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
        </span><span class="entity"><span>rtac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>refl</span></span><span>
      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>models</span></span><span> </span><span class="entity"><span>f0_alphas</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ff0_UFVarsss</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>quot</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>thm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>map</span><span> </span><span>snd</span><span> </span><span class="main"><span>(</span></span><span>flat</span><span> </span><span class="entity"><span>UFVars'ss</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>#</span></span><span>abs_rep </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Thm.symmetric</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>FVars_def2s</span></span><span>
    </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>
      </span><span>infer_instantiate'</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span>replicate</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="entity"><span>validP_prems</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span>@</span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>rep </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>inner </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"t"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>T </span><span class="entity"><span>quot</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thm</span></span><span>
    </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>quotient_fps </span><span class="entity"><span>fp_res</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>f0_UFVars'ss</span></span><span class="main"><span>;</span></span><span>

    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Local_Defs.unfold0</span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="entity"><span>defs</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>map</span></span><span> 5</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0_valid</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0_cctor</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0_swap</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ff0_UFVarss</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>{</span></span><span>
    rec_fun </span><span class="main"><span>=</span></span><span> </span><span>fst</span><span> </span><span class="entity"><span>ff0</span></span><span class="main"><span>,</span></span><span>
    rec_Uctor </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="entity"><span>ff0_cctor</span></span><span class="main"><span>,</span></span><span>
    rec_swap </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="entity"><span>ff0_swap</span></span><span class="main"><span>,</span></span><span>
    rec_valid </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="entity"><span>ff0_valid</span></span><span class="main"><span>,</span></span><span>
    rec_UFVarss </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>unfold_defs</span></span><span> </span><span class="entity"><span>ff0_UFVarss</span></span><span>
  </span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ff0s</span></span><span> </span><span class="entity"><span>ff0_valids</span></span><span> </span><span class="entity"><span>ff0_cctors</span></span><span> </span><span class="entity"><span>ff0_swaps</span></span><span> </span><span class="entity"><span>ff0_UFVarsss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>